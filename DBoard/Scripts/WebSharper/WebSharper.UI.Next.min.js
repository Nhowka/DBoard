(function(){var a=this,b=a.WebSharper=a.WebSharper||{},c=b.UI=b.UI||{},d=c.Next=c.Next||{},e=d.Array=d.Array||{},f=d.String=d.String||{},g=d.Abbrev=d.Abbrev||{},h=g.Fresh=g.Fresh||{},i=g.HashSetModule=g.HashSetModule||{},j=g.Dict=g.Dict||{},k=g.Slot=g.Slot||{},l=g.Async=g.Async||{},m=g.Mailbox=g.Mailbox||{},n=a.StartupCode$WebSharper_UI_Next$Abbrev=a.StartupCode$WebSharper_UI_Next$Abbrev||{},o=d.AppendListModule=d.AppendListModule||{},p=a.StartupCode$WebSharper_UI_Next$AppendList=a.StartupCode$WebSharper_UI_Next$AppendList||{},q=d.DomUtility=d.DomUtility||{},r=q.InsertPos=q.InsertPos||{},s=a.StartupCode$WebSharper_UI_Next$DomUtility=a.StartupCode$WebSharper_UI_Next$DomUtility||{},t=d.TrieModule=d.TrieModule||{},u=t.LookupResult=t.LookupResult||{},v=a.StartupCode$WebSharper_UI_Next$Trie=a.StartupCode$WebSharper_UI_Next$Trie||{},w=d.SnapModule=d.SnapModule||{},x=d.View=d.View||{},y=d.Var=d.Var||{},z=d.RefImpl=d.RefImpl||{},A=d.ReactiveExtensions=d.ReactiveExtensions||{},B=d.Submitter=d.Submitter||{},C=d.Key=d.Key||{},D=d.Model=d.Model||{},E=d.SerializerModule=d.SerializerModule||{},F=d.StorageModule=d.StorageModule||{},G=F.ArrayStorage=F.ArrayStorage||{},H=F.LocalStorageBackend=F.LocalStorageBackend||{},I=d.ListModel=d.ListModel||{},J=d.ListModels=d.ListModels||{},K=d.RefImpl$1=d.RefImpl$1||{},L=a.StartupCode$WebSharper_UI_Next$Models=a.StartupCode$WebSharper_UI_Next$Models||{},M=d.DoubleInterpolation=d.DoubleInterpolation||{},N=d.Interpolation=d.Interpolation||{},O=d.Easing=d.Easing||{},P=d.Easings=d.Easings||{},Q=d.An=d.An||{},R=d.Anims=d.Anims||{},S=d.Trans=d.Trans||{},T=a.StartupCode$WebSharper_UI_Next$Animation=a.StartupCode$WebSharper_UI_Next$Animation||{},U=d.AnimatedAttrNode=d.AnimatedAttrNode||{},V=d.DynamicAttrNode=d.DynamicAttrNode||{},W=d.AttrProxy=d.AttrProxy||{},X=d.Client=d.Client||{},Y=X.Attrs=X.Attrs||{},Z=Y.Dyn=Y.Dyn||{},_0=d.Attrs=d.Attrs||{},_1=d.AttrModule=d.AttrModule||{},_2=a.StartupCode$WebSharper_UI_Next$Attr=a.StartupCode$WebSharper_UI_Next$Attr||{},_3=X.DocNode=X.DocNode||{},_4=d.DocElemNode=d.DocElemNode||{},_5=X.Docs=X.Docs||{},_6=_5.DomNodes=_5.DomNodes||{},_7=_5.NodeSet=_5.NodeSet||{},_8=_5.RunState=_5.RunState||{},_9=d.Docs=d.Docs||{},_=d.CheckedInput=d.CheckedInput||{},$=d.Doc=d.Doc||{},ba=d.Elt=d.Elt||{},bb=d.Flow=d.Flow||{},bc=d.FlowBuilder=d.FlowBuilder||{},bd=d.Html=d.Html||{},be=bd.attr=bd.attr||{},bf=d.Route=d.Route||{},bg=bf.T=bf.T||{},bh=d.Routing=d.Routing||{},bi=bh.State=bh.State||{},bj=d.RouteMap=d.RouteMap||{},bk=d.Router=d.Router||{},bl=d.Input=d.Input||{},bm=bl.MousePosSt=bl.MousePosSt||{},bn=bl.MouseBtnSt=bl.MouseBtnSt||{},bo=bl.Mouse=bl.Mouse||{},bp=bl.KeyListenerSt=bl.KeyListenerSt||{},bq=bl.Keyboard=bl.Keyboard||{},br=a.StartupCode$WebSharper_UI_Next$Input=a.StartupCode$WebSharper_UI_Next$Input||{},bs=a.IntelliFactory,bt=bs&&bs.Runtime,bu=b&&b.Arrays,bv=b&&b.Strings,bw=b&&b.Char,bx=b&&b.Collections,by=bx&&bx.HashSet,bz=b&&b.Seq,bA=b&&b.Unchecked,bB=b&&b.Concurrency,bC=b&&b.List,bD=bx&&bx.Map,bE=b&&b.Option,bF=bx&&bx.FSharpMap,bG=b&&b.Enumerator,bH=bx&&bx.List,bI=b&&b.Operators,bJ=b&&b.Ref,bK=bx&&bx.Dictionary,bL=b&&b.Lazy,bM=b&&b.Slice;e.MapReduce=function(bN,bO,bP,bQ){var bR;bR=bt.Curried2(function(bS,bT){var bU,bV,bW,bX;return bT<=0?bO:(bT===1?(bS>=0?bS<bu.length(bQ):false)?true:false:false)?bN(bu.get(bQ,bS)):(bV=bT/2>>0,bW=(bR(bS))(bV),bX=(bR(bS+bV))(bT-bV),(bP(bW))(bX));});return(bR(0))(bu.length(bQ));};f.isBlank=function(bN){return bv.forall(bw.IsWhiteSpace,bN);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){n.$cctor();return n.counter;};h.set_counter=function(bN){n.$cctor();n.counter=bN;};i.Filter=function(bN,bO){var bP;return new by.New$2((bP=i.ToArray(bO),bu.filter(bN,bP)));};i.Intersect=function(bN,bO){var bP;bP=new by.New$2(i.ToArray(bN));bP.IntersectWith(i.ToArray(bO));return bP;};i.Except=function(bN,bO){var bP;bP=new by.New$2(i.ToArray(bO));bP.ExceptWith(i.ToArray(bN));return bP;};i.ToArray=function(bN){var bO;bO=bu.create(bN.get_Count(),void 0);bN.CopyTo(bO);return bO;};j.ToValueArray=function(bN){var bO,bP;bO=bu.create(bN.count,void 0);(bP=bt.Curried2(function(bQ,bR){bu.set(bO,bQ,bR.V);}),function(bQ){bz.iteri(bP,bQ);})(bN);return bO;};j.ToKeyArray=function(bN){var bO,bP;bO=bu.create(bN.count,void 0);(bP=bt.Curried2(function(bQ,bR){bu.set(bO,bQ,bR.K);}),function(bQ){bz.iteri(bP,bQ);})(bN);return bO;};k=g.Slot=bt.Class({GetHashCode:function(){return bA.Hash(this.key(this.value));},Equals:function(bN){return bA.Equals(this.key(this.value),this.key(bN.get_Value()));},get_Value:function(){return this.value;}},null,k);k.New=bt.Ctor(function(bN,bO){this.key=bN;this.value=bO;null;},k);k.Create=function(bN,bO){return new k.New(bN,bO);};l.Schedule=function(bN){var bO;bO=bB.Delay(function(){bN();return bB.Return(null);});bB.Start(bO,null);};l.StartTo=function(bN,bO){bB.StartWithContinuations(bN,bO,function(){},function(){},null);};m.StartProcessor=function(bN){var bO,bP,bQ,bR;bO=[];bP=[false];bQ=bB.Delay(function(){var bS,bT,bU;bS=(bT=bB.Delay(function(){var bV,bW;bV=bO.shift();bW=bN(bV);return bB.Bind(bW,function(){return bB.Return(null);});}),bB.While(function(){return bO.length>0;},bT));bU=bB.Delay(function(){bP[0]=false;return bB.Return(null);});return bB.Combine(bS,bU);});bR=function(){!bP[0]?(bP[0]=true,bB.Start(bQ,null)):null;};return function(bS){bO.push(bS);bR();};};n.$cctor=bt.Cctor(function(){n.counter=0;});o.FromArray=function(bN){var bO;bO=bN.length;return bO===0?{$:0}:bO===1?{$:1,$0:bu.get(bN,0)}:{$:3,$0:bN.slice()};};o.ToArray=function(bN){var bO,bP=[];bO=function(bQ){bQ.$==1?bP.push(bQ.$0):bQ.$==2?(bO(bQ.$0),bO(bQ.$1)):bQ.$==3?bu.iter(function(bR){bP.push(bR);},bQ.$0):null;};bO(bN);return bP.slice(0);};o.Single=function(bN){return{$:1,$0:bN};};o.Concat=function(bN){var bO,bP,bQ;bO=bu.ofSeq(bN);return(bP=o.Empty(),bQ=bt.Curried2(o.Append),function(bR){return e.MapReduce(a.id,bP,bQ,bR);})(bO);};o.Append=function(bN,bO){var bP;bP=[bN,bO];return bP[0].$==0?bP[1]:bP[1].$==0?bP[0]:{$:2,$0:bN,$1:bO};};o.Empty=function(){p.$cctor();return p.Empty;};p.$cctor=bt.Cctor(function(){p.Empty={$:0};});r=q.InsertPos=bt.Class({},null,r);q.SetProperty=function(bN,bO,bP){return bN.setProperty(bO,bP);};q.RemoveClass=function(bN,bO){a.jQuery(bN).removeClass(bO);};q.AddClass=function(bN,bO){a.jQuery(bN).addClass(bO);};q.InsertAt=function(bN,bO,bP){!(bP.parentNode===bN?((bt.Curried2(function(bQ,bR){var bS;bS=[bQ,bR];return bS[0].$==1?bS[1].$==1?bS[0].$0===bS[1].$0:false:bS[1].$==0?true:false;}))(bO))(function(bQ){var bR;bR=bQ.nextSibling;return bA.Equals(bR,null)?new r({$:0}):new r({$:1,$0:bR});}(bP)):false)?bO.$==1?bN.insertBefore(bP,bO.$0):bN.appendChild(bP):null;};q.RemoveNode=function(bN,bO){bO.parentNode===bN?bN.removeChild(bO):null;};q.SetStyle=function(bN,bO,bP){q.SetProperty(bN.style,bO,bP);};q.SetAttr=function(bN,bO,bP){bN.setAttribute(bO,bP);};q.RemoveAttr=function(bN,bO){bN.removeAttribute(bO);};q.CreateAttr=function(bN,bO){var bP;bP=q.Doc().createAttribute(bN);bP.value=bO;return bP;};q.CreateText=function(bN){return q.Doc().createTextNode(bN);};q.CreateSvgElement=function(bN){return q.Doc().createElementNS("http://www.w3.org/2000/svg",bN);};q.CreateElement=function(bN){return q.Doc().createElement(bN);};q.Clear=function(bN){while(bN.hasChildNodes())bN.removeChild(bN.firstChild);};q.ClearAttrs=function(bN){while(bN.hasAttributes())bN.removeAttributeNode(bN.attributes.item(0));};q.AppendTo=function(bN,bO){bN.appendChild(bO);};q.Doc=function(){s.$cctor();return s.Doc;};s.$cctor=bt.Cctor(function(){s.Doc=a.document;});u=t.LookupResult=bt.Class({},null,u);t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(bN,bO){return t.Look(bC.ofSeq(bO),bN);};t.Look=function(bN,bO){var bP,bQ,bR=[bO,bN];switch(bR[0].$==2?(bQ=bR[0].$0,0):bR[0].$==0?bR[1].$==1?(bQ=[bR[1].$0,bR[1].$1,bR[0].$0],1):2:2){case 0:bP=new u({$:0,$0:bQ,$1:bN});break;case 1:var bS;bP=(bS=bD.TryFind(bQ[0],bQ[2]),bS==null?new u({$:1}):t.Look(bQ[1],bS.$0));break;case 2:bP=new u({$:1});break;}return bP;};t.ToArray=function(bN){var bO;bO=[];t.Map(bt.Curried2(function(bP,bQ){bO.push(bQ);}),bN);return bO.slice(0);};t.Mapi=function(bN,bO){var bP,bQ;bP=[0];bQ=function(){var bR;bR=bP[0];bP[0]=bR+1;return bR;};return t.Map(bN(bQ()),bO);};t.Map=function(bN,bO){return t.MapLoop(new bC.T({$:0}),bN,bO);};t.MapLoop=function(bN,bO,bP){var bQ,bR;return bP.$==1?{$:1}:bP.$==2?{$:2,$0:(bO(bN))(bP.$0)}:(bQ=(bR=bt.Curried2(function(bS,bT){return t.MapLoop(bC.append(bN,bC.ofArray([bS])),bO,bT);}),function(bS){return bD.Map(bR,bS);})(bP.$0),t.TrieBranch(bQ));};t.Merge=function(bN){var bO,bP,bQ,bR,bS;bO=bu.ofSeq(bN);bP=bu.length(bO);return bP===0?{$:1,$0:{$:1}}:bP===1?{$:1,$0:bu.get(bO,0)}:bz.exists(t.IsLeaf,bO)?null:(bQ=(bR=(bS=function(bT){return bT.$==0?{$:1,$0:bT.$0}:null;},function(bT){return bz.choose(bS,bT);})(bO),t.MergeMaps(t.Merge,bR)),bE.map(t.TrieBranch,bQ));};t.IsLeaf=function(bN){return bN.$==2?true:false;};t.MergeMaps=function(bN,bO){var bP,bQ,bR,bS,bT,bU,bV,bW,bX;bP=(bQ=(bR=(bS=(bT=bz.collect(bD.ToSeq,bO),(bU=bt.Curried2(function(bY,bZ){return t.MultiAdd(bZ[0],bZ[1],bY);}),bV=new bF.New([]),function(bY){return bz.fold(bU,bV,bY);})(bT)),bD.ToSeq(bS)),(bW=function(bY){var bZ,b0,b1;bZ=bY[0];b0=bN(bY[1]);return(b1=function(b2){return[bZ,b2];},function(b2){return bE.map(b1,b2);})(b0);},function(bY){return bz.map(bW,bY);})(bR)),t.AllSome(bQ));return(bX=function(bY){return bD.OfArray(bu.ofSeq(bY));},function(bY){return bE.map(bX,bY);})(bP);};t.AllSome=function(bN){var bO,bP=bG.Get(bN),bQ=new bH.New$2();bO=true;while(bO?bP.MoveNext():false){var bR;bR=bP.Current();(bR!=null?bR.$==1:false)?bQ.Add(bR.$0):void(bO=false);}return bO?{$:1,$0:bQ.ToArray()}:null;};t.MultiAdd=function(bN,bO,bP){return bP.Add(bN,new bC.T({$:1,$0:bO,$1:t.MultiFind(bN,bP)}));};t.MultiFind=function(bN,bO){return bI.DefaultArg(bD.TryFind(bN,bO),new bC.T({$:0}));};t.Prefix=function(bN,bO){return t.TrieBranch(new bF.New(bC.ofArray([[bN,bO]])));};t.Leaf=function(bN){return{$:2,$0:bN};};t.TrieBranch=function(bN){return bN.get_IsEmpty()?{$:1}:{$:0,$0:bN};};v.$cctor=bt.Cctor(function(){v.Empty={$:1};});w.MapAsync=function(bN,bO){var bP;bP=w.Create();w.When(bO,function(bQ){l.StartTo(bN(bQ),function(bR){w.MarkDone(bP,bO,bR);});},function(){w.MarkObsolete(bP);});return bP;};w.SnapshotOn=function(bN,bO){var bP,bQ,bR,bS;bP=w.Create();bQ=[null];bR=[false];bS=function(){var bT,bU;bR[0]?(bT=bQ[0],((bT!=null?bT.$==1:false)?w.IsForever(bN)?(bU=bT.$0,true):false:false)?w.MarkForever(bP,bU):(bT!=null?bT.$==1:false)?w.MarkReady(bP,bT.$0):null):null;};w.When(bN,function(){bR[0]=true;bS();},function(){bQ[0]=null;w.MarkObsolete(bP);});w.When(bO,function(bT){bQ[0]={$:1,$0:bT};bS();},function(){});return bP;};w.Map3=function(bN,bO,bP,bQ){function b6(){b2[0]=null;b3[0]=null;b4[0]=null;w.MarkObsolete(b1);}var bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5;bR=[bO.State,bP.State,bQ.State];return bR[0].$==0?bR[1].$==0?bR[2].$==0?w.CreateForever(((bN(bR[0].$0))(bR[1].$0))(bR[2].$0)):(bS=bR[0].$0,bT=bR[1].$0,w.Map((bN(bS))(bT),bQ)):bR[2].$==0?(bU=bR[0].$0,bV=bR[2].$0,w.Map(function(b7){return((bN(bU))(b7))(bV);},bP)):(bW=bR[0].$0,w.Map2(bt.Curried2(function(b7,b8){return((bN(bW))(b7))(b8);}),bP,bQ)):bR[1].$==0?bR[2].$==0?(bX=bR[1].$0,bY=bR[2].$0,w.Map(function(b7){return((bN(b7))(bX))(bY);},bO)):(bZ=bR[1].$0,w.Map2(bt.Curried2(function(b7,b8){return((bN(b7))(bZ))(b8);}),bO,bQ)):bR[2].$==0?(b0=bR[2].$0,w.Map2(bt.Curried2(function(b7,b8){return((bN(b7))(b8))(b0);}),bO,bP)):(b1=w.Create(),b2=[null],b3=[null],b4=[null],b5=function(){var b7,b8,b9,b_,b$,ca,cb;b7=[b2[0],b3[0],b4[0]];(b8=b7[0],b8!=null?b8.$==1:false)?(b9=b7[1],b9!=null?b9.$==1:false)?(b_=b7[2],b_!=null?b_.$==1:false)?(b$=b7[0].$0,ca=b7[1].$0,cb=b7[2].$0,((w.IsForever(bO)?w.IsForever(bP):false)?w.IsForever(bQ):false)?w.MarkForever(b1,((bN(b$))(ca))(cb)):w.MarkReady(b1,((bN(b$))(ca))(cb))):null:null:null;},w.When(bO,function(b7){b2[0]={$:1,$0:b7};b5();},b6),w.When(bP,function(b7){b3[0]={$:1,$0:b7};b5();},b6),w.When(bQ,function(b7){b4[0]={$:1,$0:b7};b5();},b6),b1);};w.Map2=function(bN,bO,bP){function bW(){bT[0]=null;bU[0]=null;w.MarkObsolete(bS);}var bQ,bR,bS,bT,bU,bV;bQ=[bO.State,bP.State];return bQ[0].$==0?bQ[1].$==0?w.CreateForever((bN(bQ[0].$0))(bQ[1].$0)):w.Map(bN(bQ[0].$0),bP):bQ[1].$==0?(bR=bQ[1].$0,w.Map(function(bX){return(bN(bX))(bR);},bO)):(bS=w.Create(),bT=[null],bU=[null],bV=function(){var bX,bY,bZ,b0,b1;bX=[bT[0],bU[0]];(bY=bX[0],bY!=null?bY.$==1:false)?(bZ=bX[1],bZ!=null?bZ.$==1:false)?(b0=bX[0].$0,b1=bX[1].$0,(w.IsForever(bO)?w.IsForever(bP):false)?w.MarkForever(bS,(bN(b0))(b1)):w.MarkReady(bS,(bN(b0))(b1))):null:null;},w.When(bO,function(bX){bT[0]={$:1,$0:bX};bV();},bW),w.When(bP,function(bX){bU[0]={$:1,$0:bX};bV();},bW),bS);};w.MapCached=function(bN,bO,bP){return w.Map(function(bQ){var bR,bS,bT;bR=bN[0];return((bR!=null?bR.$==1:false)?bA.Equals(bQ,bR.$0[0])?(bS=[bR.$0[0],bR.$0[1]],true):false:false)?bS[1]:(bT=bO(bQ),bN[0]={$:1,$0:[bQ,bT]},bT);},bP);};w.Map=function(bN,bO){var bP,bQ,bR;bP=bO.State;return bP.$==0?w.CreateForever(bN(bP.$0)):(bQ=w.Create(),w.When(bO,(bR=function(bS){w.MarkDone(bQ,bO,bS);},function(bS){return bR(bN(bS));}),function(){w.MarkObsolete(bQ);}),bQ);};w.Sequence=function(bN){var bO,bP,bQ,bR,bS,bT,bU,bV;return bz.isEmpty(bN)?w.CreateForever([]):(bO=w.Create(),bP=bu.ofSeq(bN),bQ=bu.length(bP),bR=[0],bS=[[]],bT=function(){bR[0]=0;bS[0]=[];w.MarkObsolete(bO);},bU=function(){bR[0]===bQ?bz.forall(w.IsForever,bP)?w.MarkForever(bO,bS[0]):w.MarkReady(bO,bS[0]):null;},(bV=bt.Curried2(function(bW,bX){w.When(bX,function(bY){bS[0][bW]=bY;bJ.incr(bR);bU();},bT);}),function(bW){bu.iteri(bV,bW);})(bP),bO);};w.CreateForeverAsync=function(bN){var bO,bP;bO=w.Make({$:3,$0:[],$1:[]});bP=bB.Delay(function(){return bB.Bind(bN,function(bQ){w.MarkForever(bO,bQ);return bB.Return(null);});});bB.Start(bP,null);return bO;};w.Bind=function(bN,bO){var bP,bQ;bP=w.Create();bQ=function(){w.MarkObsolete(bP);};w.When(bO,function(bR){var bS;bS=bN(bR);w.When(bS,function(bT){(w.IsForever(bS)?w.IsForever(bO):false)?w.MarkForever(bP,bT):w.MarkReady(bP,bT);},bQ);},bQ);return bP;};w.When=function(bN,bO,bP){var bQ;bQ=bN.State;bQ.$==1?bP():bQ.$==2?(bQ.$1.push(bP),bO(bQ.$0)):bQ.$==3?(bQ.$0.push(bO),bQ.$1.push(bP)):bO(bQ.$0);};w.MarkDone=function(bN,bO,bP){w.IsForever(bO)?w.MarkForever(bN,bP):w.MarkReady(bN,bP);};w.MarkReady=function(bN,bO){var bP;bP=bN.State;bP.$==3?(bN.State={$:2,$0:bO,$1:bP.$1},bz.iter(function(bQ){bQ(bO);},bP.$0)):null;};w.MarkObsolete=function(bN){var bO,bP;bO=bN.State;(bO.$==1?true:bO.$==2?(bP=bO.$1,false):bO.$==3?(bP=bO.$1,false):true)?null:(bN.State={$:1},bz.iter(function(bQ){bQ();},bP));};w.MarkForever=function(bN,bO){var bP;bP=bN.State;bP.$==3?(bN.State={$:0,$0:bO},bz.iter(function(bQ){bQ(bO);},bP.$0)):null;};w.IsObsolete=function(bN){return bN.State.$==1?true:false;};w.IsForever=function(bN){return bN.State.$==0?true:false;};w.CreateWithValue=function(bN){return w.Make({$:2,$0:bN,$1:[]});};w.CreateForever=function(bN){return w.Make({$:0,$0:bN});};w.Create=function(){return w.Make({$:3,$0:[],$1:[]});};w.Make=function(bN){return{State:bN};};x=d.View=bt.Class({},null,x);y=d.Var=bt.Class({get_View:function(){var bN;bN=this;return new x({$:0,$0:function(){return y.Observe(bN);}});},RId:function(){return"uinref"+a.String(y.GetId(this));},RView:function(){return this.get_View();},RUpdateMaybe:function(bN){var bO;bO=bN(y.Get(this));(bO!=null?bO.$==1:false)?y.Set(this,bO.$0):null;},RUpdate:function(bN){y.Update(this,bN);},WebSharper_UI_Next_IRef_1$set_Value:function(bN){y.Set(this,bN);},WebSharper_UI_Next_IRef_1$get_Value:function(){return y.Get(this);},RSet:function(bN){y.Set(this,bN);},RGet:function(){return y.Get(this);}},null,y);y.New=function(bN,bO,bP,bQ){return new y({Const:bN,Current:bO,Snap:bP,Id:bQ});};y.Lens=function(bN,bO,bP){return new z.New(bN,bO,bP);};y.Observe=function(bN){return bN.Snap;};y.GetId=function(bN){return bN.Id;};y.Update=function(bN,bO){var bP;bP=bO(y.Get(bN));y.Set(bN,bP);};y.SetFinal=function(bN,bO){bN.Const?null:(bN.Const=true,bN.Current=bO,bN.Snap=w.CreateForever(bO));};y.Set=function(bN,bO){bN.Const?null:(w.MarkObsolete(bN.Snap),bN.Current=bO,bN.Snap=w.CreateWithValue(bO));};y.Get=function(bN){return bN.Current;};y.Create=function(){return y.New(false,null,w.CreateWithValue(),h.Int());};y.Create$1=function(bN){return y.New(false,bN,w.CreateWithValue(bN),h.Int());};x.get_Do=function(){return{$:0};};x.Apply=function(bN,bO){return x.Map2(bt.Curried2(function(bP,bQ){return bP(bQ);}),bN,bO);};x.Sink=function(bN,bO){var bP,bQ=bO.$0;bP=function(){var bR;bR=bQ();w.When(bR,bN,function(){l.Schedule(bP);});};l.Schedule(bP);};x.TryFinally=function(bN,bO){var bP;bP=bO.$0;return x.CreateLazy(function(){var bQ;try{bQ=bP();}finally{bN();}return bQ;});};x.TryWith=function(bN,bO){var bP;bP=bO.$0;return x.CreateLazy(function(){var bQ;try{bQ=bP();}catch(bR){bQ=bN(bR).$0();}return bQ;});};x.ConstAsync=function(bN){var bO;bO=w.CreateForeverAsync(bN);return new x({$:0,$0:function(){return bO;}});};x.Const=function(bN){var bO;bO=w.CreateForever(bN);return new x({$:0,$0:function(){return bO;}});};x.Sequence=function(bN){return x.CreateLazy(function(){var bO,bP;bO=(bP=function(bQ){return bQ.$0();},function(bQ){return bz.map(bP,bQ);})(bN);return w.Sequence(bO);});};x.Bind=function(bN,bO){return x.Join(x.Map(bN,bO));};x.Join=function(bN){var bO;bO=bN.$0;return x.CreateLazy(function(){var bP,bQ;bP=bO();return(bQ=function(bR){return bR.$0();},function(bR){return w.Bind(bQ,bR);})(bP);});};x.MapSeqCachedView=function(bN,bO){return x.MapSeqCachedViewBy(a.id,bt.Curried2(function(bP,bQ){return bN(bQ);}),bO);};x.MapSeqCachedViewBy=function(bN,bO,bP){var bQ;bQ=[new bK.New$5()];return((bt.Curried2(x.Map))(function(bR){var bS,bT,bU,bV,bW;bS=bQ[0];bT=new bK.New$5();bU=(bV=bu.ofSeq(bR),(bW=function(bX){var bY,bZ,b0,b1;bY=bN(bX);bZ=bS.ContainsKey(bY)?(b0=bS.get_Item(bY),y.Set(b0.NVar,bX),b0):(b1=bO(bY),x.ConvertSeqNode(b1,bX));bT.set_Item(bY,bZ);return bZ.NValue;},function(bX){return bu.map(bW,bX);})(bV));bQ[0]=bT;return bU;}))(bP);};x.ConvertSeqNode=function(bN,bO){var bP,bQ;bP=y.Create$1(bO);bQ=bP.get_View();return{NValue:bN(bQ),NVar:bP,NView:bQ};};x.MapSeqCached=function(bN,bO){return x.MapSeqCachedBy(a.id,bN,bO);};x.MapSeqCachedBy=function(bN,bO,bP){var bQ;bQ=[new bK.New$5()];return((bt.Curried2(x.Map))(function(bR){var bS,bT,bU,bV,bW;bS=bQ[0];bT=new bK.New$5();bU=(bV=bu.ofSeq(bR),(bW=function(bX){var bY,bZ;bY=bN(bX);bZ=bS.ContainsKey(bY)?bS.get_Item(bY):bO(bX);bT.set_Item(bY,bZ);return bZ;},function(bX){return bu.map(bW,bX);})(bV));bQ[0]=bT;return bU;}))(bP);};x.UpdateWhile=function(bN,bO,bP){var bQ;bQ=[bN];return x.Map2(bt.Curried2(function(bR,bS){bR?void(bQ[0]=bS):null;return bQ[0];}),bO,bP);};x.SnapshotOn=function(bN,bO,bP){var bQ,bR,bS;bQ=bO.$0;bR=bP.$0;bS=w.CreateWithValue(bN);return x.CreateLazy(function(){var bT,bU,bV;bT=bQ();bU=bR();return w.IsObsolete(bS)?w.SnapshotOn(bT,bU):(bV=w.SnapshotOn(bT,bU),w.When(bV,function(){},function(){w.MarkObsolete(bS);}),bS);});};x.GetAsync=function(bN){return bB.FromContinuations(function(bO){x.Get(bO[0],bN);});};x.Get=function(bN,bO){var bP,bQ=bO.$0,bR=[false];bP=function(){w.When(bQ(),function(bS){!bR[0]?(bR[0]=true,bN(bS)):null;},function(){!bR[0]?bP():null;});};bP();};x.MapAsync2=function(bN,bO,bP){var bQ;bQ=x.Map2(bN,bO,bP);return((bt.Curried2(x.MapAsync))(a.id))(bQ);};x.MapAsync=function(bN,bO){var bP;bP=bO.$0;return x.CreateLazy(function(){var bQ;bQ=bP();return w.MapAsync(bN,bQ);});};x.Map2=function(bN,bO,bP){return x.CreateLazy2(bt.Curried2(function(bQ,bR){return w.Map2(bN,bQ,bR);}),bO,bP);};x.CreateLazy2=function(bN,bO,bP){var bQ,bR;bQ=bO.$0;bR=bP.$0;return x.CreateLazy(function(){var bS,bT;bS=bQ();bT=bR();return(bN(bS))(bT);});};x.MapCached=function(bN,bO){var bP,bQ;bP=bO.$0;bQ=[null];return x.CreateLazy(function(){var bR;bR=bP();return w.MapCached(bQ,bN,bR);});};x.Map=function(bN,bO){var bP;bP=bO.$0;return x.CreateLazy(function(){var bQ;bQ=bP();return w.Map(bN,bQ);});};x.CreateLazy=function(bN){var bO;bO=[null];return new x({$:0,$0:function(){var bP,bQ,bR;bP=bO[0];return((bP!=null?bP.$==1:false)?!w.IsObsolete(bP.$0)?(bQ=bP.$0,true):false:false)?bQ:(bR=bN(),bO[0]={$:1,$0:bR},bR);}});};z=d.RefImpl=bt.Class({RId:function(){return this.id;},RView:function(){var bN;bN=this.baseRef.RView();return((bt.Curried2(x.Map))(this.get))(bN);},RUpdateMaybe:function(bN){var bO;bO=this;this.baseRef.RUpdateMaybe(function(bP){return bE.map(bO.update(bP),bN(bO.get(bP)));});},RUpdate:function(bN){var bO;bO=this;this.baseRef.RUpdate(function(bP){return(bO.update(bP))(bN(bO.get(bP)));});},WebSharper_UI_Next_IRef_1$set_Value:function(bN){var bO;bO=this;this.baseRef.RUpdate(function(bP){return(bO.update(bP))(bN);});},WebSharper_UI_Next_IRef_1$get_Value:function(){return this.get(this.baseRef.RGet());},RSet:function(bN){var bO;bO=this;this.baseRef.RUpdate(function(bP){return(bO.update(bP))(bN);});},RGet:function(){return this.get(this.baseRef.RGet());}},null,z);z.New=bt.Ctor(function(bN,bO,bP){this.baseRef=bN;this.get=bO;this.update=bP;this.id=h.Id();null;},z);A=d.ReactiveExtensions=bt.Class({},null,A);A.New=bt.Ctor(function(){},A);B=d.Submitter=bt.Class({Trigger:function(){y.Set(this["var"],null);}},null,B);B.New=bt.Ctor(function(bN,bO){var bP;this.input=bN;this["var"]=y.Create();this.view=(bP=this["var"].get_View(),x.SnapshotOn(bO,bP,this.input));null;},B);B.CreateOption=function(bN){return new B.New(x.Map(function(bO){return{$:1,$0:bO};},bN),null);};C=d.Key=bt.Class({},null,C);C.Fresh=function(){return new C({$:0,$0:h.Int()});};D=d.Model=bt.Class({get_View:function(){return this.view;},get_Var:function(){return this["var"];}},null,D);D.New=bt.Ctor(function(bN,bO){var bP,bQ,bR;bP=y.Create$1(bO);bQ=(bR=bP.get_View(),x.Map(bN,bR));D.New$1.call(this,bP,bQ);},D);D.New$1=bt.Ctor(function(bN,bO){this["var"]=bN;this.view=bO;null;},D);D.View=function(bN){return bN.get_View();};D.Update=function(bN,bO){var bP;bP=bO.get_Var();y.Update(bP,function(bQ){bN(bQ);return bQ;});};D.Create=function(bN,bO){return new D.New(bN,bO);};E.Default=function(){L.$cctor();return L.Default;};G=F.ArrayStorage=bt.Class({SSet:function(bN){return bu.ofSeq(bN);},SSetAt:function(bN,bO,bP){bu.set(bP,bN,bO);return bP;},SRemoveIf:function(bN,bO){return bu.filter(bN,bO);},SInit:function(){return this.init;},SPrependMany:function(bN,bO){bO.unshift.apply(bO,bu.ofSeq(bN));return bO;},SPrepend:function(bN,bO){bO.unshift(bN);return bO;},SAppendMany:function(bN,bO){bO.push.apply(bO,bu.ofSeq(bN));return bO;},SAppend:function(bN,bO){bO.push(bN);return bO;}},null,G);G.New=bt.Ctor(function(bN){this.init=bN;null;},G);H=F.LocalStorageBackend=bt.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bN){var bO,bP;this.storage.setItem(this.id,(bO=(bP=this.serializer.Encode,function(bQ){return bu.map(bP,bQ);})(bN),a.JSON.stringify(bO)));return bN;},SSet:function(bN){var bO;bO=this;return bO.set(bu.ofSeq(bN));},SSetAt:function(bN,bO,bP){bu.set(bP,bN,bO);return this.set(bP);},SRemoveIf:function(bN,bO){var bP;bP=this;return bP.set(bu.filter(bN,bO));},SInit:function(){var bN,bO=this.storage.getItem(this.id);if(bO===null)bN=[];else try{var bP,bQ;bN=(bP=a.JSON.parse(bO),(bQ=this.serializer.Decode,function(bR){return bu.map(bQ,bR);})(bP));}catch(bR){bN=[];}return bN;},SPrependMany:function(bN,bO){bO.unshift.apply(bO,bu.ofSeq(bN));return this.set(bO);},SPrepend:function(bN,bO){bO.unshift(bN);return this.set(bO);},SAppendMany:function(bN,bO){bO.push.apply(bO,bu.ofSeq(bN));return this.set(bO);},SAppend:function(bN,bO){bO.push(bN);return this.set(bO);}},null,H);H.New=bt.Ctor(function(bN,bO){this.id=bN;this.serializer=bO;this.storage=a.window.localStorage;null;},H);F.LocalStorage=function(bN,bO){return new H.New(bN,bO);};F.InMemory=function(bN){return new G.New(bN);};I=d.ListModel=bt.Class({Wrap:function(bN,bO,bP){return I.Wrap(this,bN,bO,bP);},Lens:function(bN){var bO;bO=this;return bO.LensInto(a.id,bt.Curried2(function(bP,bQ){return bQ;}),bN);},LensInto:function(bN,bO,bP){return new K.New(this,bP,bN,bO);},get_LengthAsView:function(){var bN;bN=this["var"].RView();return((bt.Curried2(x.Map))(bu.length))(bN);},get_Length:function(){return bu.length(this["var"].WebSharper_UI_Next_IRef_1$get_Value());},Clear:function(){this["var"].WebSharper_UI_Next_IRef_1$set_Value(this.storage.SSet([]));},UpdateBy:function(bN,bO){var bP,bQ,bR,bS,bT,bU;bP=this;bQ=this["var"].WebSharper_UI_Next_IRef_1$get_Value();bR=bu.tryFindIndex(function(bV){return bA.Equals(bP["key@150"](bV),bO);},bQ);(bR!=null?bR.$==1:false)?(bS=bR.$0,bT=bN(bu.get(bQ,bS)),(bT!=null?bT.$==1:false)?this["var"].WebSharper_UI_Next_IRef_1$set_Value(((bU=this.storage,(bt.Curried3(function(bV,bW,bX){return bU.SSetAt(bV,bW,bX);}))(bS))(bT.$0))(bQ)):null):null;},UpdateAll:function(bN){var bO,bP;bO=this;bP=this["var"];bP.RUpdate(function(bQ){var bR;(bR=bt.Curried2(function(bS,bT){var bU,bV;bU=bN(bT);(bV=function(bW){bu.set(bQ,bS,bW);},function(bW){bE.iter(bV,bW);})(bU);}),function(bS){bu.iteri(bR,bS);})(bQ);return bO.storage.SSet(bQ);});},TryFindByKeyAsView:function(bN){var bO,bP,bQ;bO=this;bP=this["var"].RView();return((bt.Curried2(x.Map))((bQ=function(bR){return bA.Equals(bO["key@150"](bR),bN);},function(bR){return bu.tryFind(bQ,bR);})))(bP);},FindByKeyAsView:function(bN){var bO,bP,bQ;bO=this;bP=this["var"].RView();return((bt.Curried2(x.Map))((bQ=function(bR){return bA.Equals(bO["key@150"](bR),bN);},function(bR){return bu.find(bQ,bR);})))(bP);},TryFindByKey:function(bN){var bO;bO=this;return bu.tryFind(function(bP){return bA.Equals(bO["key@150"](bP),bN);},this["var"].WebSharper_UI_Next_IRef_1$get_Value());},FindByKey:function(bN){var bO;bO=this;return bu.find(function(bP){return bA.Equals(bO["key@150"](bP),bN);},this["var"].WebSharper_UI_Next_IRef_1$get_Value());},TryFindAsView:function(bN){var bO;bO=this["var"].RView();return((bt.Curried2(x.Map))(function(bP){return bu.tryFind(bN,bP);}))(bO);},FindAsView:function(bN){var bO;bO=this["var"].RView();return((bt.Curried2(x.Map))(function(bP){return bu.find(bN,bP);}))(bO);},TryFind:function(bN){return bu.tryFind(bN,this["var"].WebSharper_UI_Next_IRef_1$get_Value());},Find:function(bN){return bu.find(bN,this["var"].WebSharper_UI_Next_IRef_1$get_Value());},ContainsKeyAsView:function(bN){var bO,bP,bQ;bO=this;bP=this["var"].RView();return((bt.Curried2(x.Map))((bQ=function(bR){return bA.Equals(bO["key@150"](bR),bN);},function(bR){return bz.exists(bQ,bR);})))(bP);},ContainsKey:function(bN){var bO;bO=this;return bz.exists(function(bP){return bA.Equals(bO["key@150"](bP),bN);},this["var"].WebSharper_UI_Next_IRef_1$get_Value());},Set:function(bN){this["var"].WebSharper_UI_Next_IRef_1$set_Value(this.storage.SSet(bN));},Iter:function(bN){bu.iter(bN,this["var"].WebSharper_UI_Next_IRef_1$get_Value());},RemoveByKey:function(bN){var bO,bP;bO=this;this["var"].WebSharper_UI_Next_IRef_1$set_Value((bP=this.storage,(bt.Curried2(function(bQ,bR){return bP.SRemoveIf(bQ,bR);}))(function(bQ){return!bA.Equals(bO["key@150"](bQ),bN);}))(this["var"].WebSharper_UI_Next_IRef_1$get_Value()));},RemoveBy:function(bN){var bO,bP;this["var"].WebSharper_UI_Next_IRef_1$set_Value((bO=this.storage,(bt.Curried2(function(bQ,bR){return bO.SRemoveIf(bQ,bR);}))((bP=function(bQ){return!bQ;},function(bQ){return bP(bN(bQ));})))(this["var"].WebSharper_UI_Next_IRef_1$get_Value()));},Remove:function(bN){var bO,bP,bQ,bR,bS;bO=this;bP=this["var"].WebSharper_UI_Next_IRef_1$get_Value();J.Contains(bO["key@150"],bN,bP)?(bQ=bO["key@150"],bR=bQ(bN),this["var"].WebSharper_UI_Next_IRef_1$set_Value((bS=this.storage,(bt.Curried2(function(bT,bU){return bS.SRemoveIf(bT,bU);}))(function(bT){return!bA.Equals(bQ(bT),bR);}))(bP))):null;},PrependMany:function(bN){var bO,bP,bQ,bR,bS,bT;bO=this;bP=new bH.New$2();bQ=(bR=this["var"].WebSharper_UI_Next_IRef_1$get_Value(),((bS=bt.Curried2(function(bU,bV){var bW,bX,bY;bW=bO["key@150"](bV);bX=bu.tryFindIndex(function(bZ){return bA.Equals(bO["key@150"](bZ),bW);},bU);return bX==null?(bP.Add(bV),bU):((bY=bO.storage,(bt.Curried3(function(bZ,b0,b1){return bY.SSetAt(bZ,b0,b1);}))(bX.$0))(bV))(bU);}),bt.Curried2(function(bU,bV){return bz.fold(bS,bU,bV);}))(bR))(bN));this["var"].WebSharper_UI_Next_IRef_1$set_Value((bT=this.storage,(bt.Curried2(function(bU,bV){return bT.SPrependMany(bU,bV);}))(bP))(bQ));},Prepend:function(bN){var bO,bP,bQ,bR,bS,bT;bO=this;bP=this["var"].WebSharper_UI_Next_IRef_1$get_Value();bQ=this["key@150"](bN);bR=bu.tryFindIndex(function(bU){return bA.Equals(bO["key@150"](bU),bQ);},bP);(bR!=null?bR.$==1:false)?this["var"].WebSharper_UI_Next_IRef_1$set_Value(((bS=this.storage,(bt.Curried3(function(bU,bV,bW){return bS.SSetAt(bU,bV,bW);}))(bR.$0))(bN))(bP)):this["var"].WebSharper_UI_Next_IRef_1$set_Value((bT=this.storage,(bt.Curried2(function(bU,bV){return bT.SPrepend(bU,bV);}))(bN))(bP));},AppendMany:function(bN){var bO,bP,bQ,bR,bS,bT;bO=this;bP=new bH.New$2();bQ=(bR=this["var"].WebSharper_UI_Next_IRef_1$get_Value(),((bS=bt.Curried2(function(bU,bV){var bW,bX,bY;bW=bO["key@150"](bV);bX=bu.tryFindIndex(function(bZ){return bA.Equals(bO["key@150"](bZ),bW);},bU);return bX==null?(bP.Add(bV),bU):((bY=bO.storage,(bt.Curried3(function(bZ,b0,b1){return bY.SSetAt(bZ,b0,b1);}))(bX.$0))(bV))(bU);}),bt.Curried2(function(bU,bV){return bz.fold(bS,bU,bV);}))(bR))(bN));this["var"].WebSharper_UI_Next_IRef_1$set_Value((bT=this.storage,(bt.Curried2(function(bU,bV){return bT.SAppendMany(bU,bV);}))(bP))(bQ));},Append:function(bN){var bO,bP,bQ,bR,bS,bT;bO=this;bP=this["var"].WebSharper_UI_Next_IRef_1$get_Value();bQ=this["key@150"](bN);bR=bu.tryFindIndex(function(bU){return bA.Equals(bO["key@150"](bU),bQ);},bP);(bR!=null?bR.$==1:false)?this["var"].WebSharper_UI_Next_IRef_1$set_Value(((bS=this.storage,(bt.Curried3(function(bU,bV,bW){return bS.SSetAt(bU,bV,bW);}))(bR.$0))(bN))(bP)):this["var"].WebSharper_UI_Next_IRef_1$set_Value((bT=this.storage,(bt.Curried2(function(bU,bV){return bT.SAppend(bU,bV);}))(bN))(bP));},GetEnumerator0:function(){return bG.Get0(this["var"].WebSharper_UI_Next_IRef_1$get_Value());},GetEnumerator:function(){return bG.Get(this["var"].WebSharper_UI_Next_IRef_1$get_Value());}},null,I);I.New=bt.Ctor(function(bN,bO){var bP,bQ,bR;bP=(bQ=(bR=bz.distinctBy(bN,bO.SInit()),bu.ofSeq(bR)),y.Create$1(bQ));I.New$3.call(this,bN,bP,bO);},I);I.New$1=bt.Ctor(function(bN){I.New$2.call(this,bN,[]);},I);I.New$2=bt.Ctor(function(bN,bO){var bP;bP=bu.ofSeq(bO);I.New$3.call(this,bN,y.Create$1(bP),F.InMemory(bP));},I);I.New$3=bt.Ctor(function(bN,bO,bP){var bQ,bR;bQ=this;this["key@150"]=bN;this["var"]=bO;this.storage=bP;this.v=(bR=this["var"].RView(),((bt.Curried2(x.Map))(function(bS){bQ.storage.SSet(bS);return bS.slice();}))(bR));null;},I);J.Contains=function(bN,bO,bP){var bQ;bQ=bN(bO);return bz.exists(function(bR){return bA.Equals(bN(bR),bQ);},bP);};K=d.RefImpl$1=bt.Class({RId:function(){return this.id;},RView:function(){var bN;bN=this.m.FindByKeyAsView(this.key);return((bt.Curried2(x.Map))(this.get))(bN);},RUpdateMaybe:function(bN){var bO,bP;bO=this;(bP=this.m,(bt.Curried2(function(bQ,bR){bP.UpdateBy(bQ,bR);}))(function(bQ){return bE.map(bO.update(bQ),bN(bO.get(bQ)));}))(this.key);},RUpdate:function(bN){var bO,bP;bO=this;(bP=this.m,(bt.Curried2(function(bQ,bR){bP.UpdateBy(bQ,bR);}))(function(bQ){return{$:1,$0:(bO.update(bQ))(bN(bO.get(bQ)))};}))(this.key);},WebSharper_UI_Next_IRef_1$set_Value:function(bN){this.RSet(bN);},WebSharper_UI_Next_IRef_1$get_Value:function(){return this.RGet();},RSet:function(bN){var bO,bP;bO=this;(bP=this.m,(bt.Curried2(function(bQ,bR){bP.UpdateBy(bQ,bR);}))(function(bQ){return{$:1,$0:(bO.update(bQ))(bN)};}))(this.key);},RGet:function(){return this.get(this.m.FindByKey(this.key));}},null,K);K.New=bt.Ctor(function(bN,bO,bP,bQ){this.m=bN;this.key=bO;this.get=bP;this.update=bQ;this.id=h.Id();null;},K);I.Key=function(bN){return bN["key@150"];};I.View=function(bN){return bN.v;};I.Wrap=function(bN,bO,bP,bQ){var bR,bS,bT,bU,bV,bW,bX;bR=[new bK.New$5()];bS=(bT=bN["var"].WebSharper_UI_Next_IRef_1$get_Value(),(bU=function(bY){var bZ;bZ=bP(bY);bR[0].set_Item(bN["key@150"](bY),bZ);return bZ;},function(bY){return bu.map(bU,bY);})(bT));bV=(bW=bN["var"],(bt.Curried2(function(bY,bZ){return y.Lens(bW,bY,bZ);}))(function(bY){var bZ,b0,b1;bZ=new bK.New$5();b0=(b1=function(b2){var b3,b4;b3=bN["key@150"](b2);b4=bR[0].ContainsKey(b3)?(bQ(bR[0].get_Item(b3)))(b2):bP(b2);bZ.set_Item(b3,b4);return b4;},function(b2){return bu.map(b1,b2);})(bY);bR[0]=bZ;return b0;}))(bt.Curried2(function(bY,bZ){var b0,b1,b2;b0=new bK.New$5();b1=(b2=function(b3){var b4;b4=bO(b3);b0.set_Item(bN["key@150"](b4),b3);return b4;},function(b3){return bu.map(b2,b3);})(bZ);bR[0]=b0;return b1;}));return new I.New$3((bX=bN["key@150"],function(bY){return bX(bO(bY));}),bV,F.InMemory(bS));};I.FromSeq=function(bN){return I.Create(a.id,bN);};I.Create=function(bN,bO){var bP;bP=F.InMemory(bu.ofSeq(bO));return I.CreateWithStorage(bN,bP);};I.CreateWithStorage=function(bN,bO){return new I.New(bN,bO);};L.$cctor=bt.Cctor(function(){L.Default={Encode:a.id,Decode:a.id};});M=d.DoubleInterpolation=bt.Class({Interpolate:function(bN,bO,bP){return bO+bN*(bP-bO);}},null,M);N.get_Double=function(){return new M({$:0});};O=d.Easing=bt.Class({TransformTime:function(bN){return this.transformTime(bN);}},null,O);O.get_CubicInOut=function(){return P.CubicInOut();};O.Custom=function(bN){return new O.New(bN);};O.New=bt.Ctor(function(bN){this.transformTime=bN;null;},O);P.CubicInOut=function(){T.$cctor();return T.CubicInOut;};Q=d.An=bt.Class({},null,Q);Q.get_Empty=function(){return new Q({$:0,$0:o.Empty()});};Q.WhenDone=function(bN,bO){return((bt.Curried2(Q.Append))(new Q({$:0,$0:o.Single({$:0,$0:bN})})))(bO);};Q.Run=function(bN,bO){var bP;bP=bO.Duration;return bB.FromContinuations(function(bQ){var bR,bS=bQ[0];bR=bt.Curried2(function(bT,bU){var bV;bV=bU-bT;bO.Compute(bV);bN();bV<=bP?a.requestAnimationFrame(function(bW){(bR(bT))(bW);}):bS();});a.requestAnimationFrame(function(bT){(bR(bT))(bT);});});};Q.Play=function(bN){return bB.Delay(function(){var bO,bP;bO=(bP=R.Actions(bN),((bt.Curried2(Q.Run))(function(){}))(bP));return bB.Bind(bO,function(){R.Finalize(bN);return bB.Return(null);});});};Q.Pack=function(bN){return new Q({$:0,$0:o.Single({$:1,$0:bN})});};Q.Map=function(bN,bO){var bP;return R.Def(bO.Duration,(bP=bO.Compute,function(bQ){return bN(bP(bQ));}));};Q.Delayed=function(bN,bO,bP,bQ,bR,bS){return{Compute:function(bT){return bT<=bQ?bR:bN.Interpolate(bO.TransformTime((bT-bQ)/bP),bR,bS);},Duration:bP+bQ};};Q.Simple=function(bN,bO,bP,bQ,bR){return{Compute:function(bS){return bN.Interpolate(bO.TransformTime(bS/bP),bQ,bR);},Duration:bP};};Q.Const=function(bN){return R.Const(bN);};Q.Concat=function(bN){var bO;bO=o.Concat(bz.map(R.List,bN));return new Q({$:0,$0:bO});};Q.Append=function(bN,bO){return new Q({$:0,$0:o.Append(bN.$0,bO.$0)});};R.Actions=function(bN){var bO,bP,bQ;bO=(bP=o.ToArray(bN.$0),(bQ=function(bR){return bR.$==1?{$:1,$0:bR.$0}:null;},function(bR){return bu.choose(bQ,bR);})(bP));return R.ConcatActions(bO);};R.ConcatActions=function(bN){var bO,bP,bQ,bR,bS,bT;bO=bu.ofSeq(bN);bP=bu.length(bO);return bP===0?R.Const():bP===1?bu.get(bO,0):(bQ=(bR=(bS=function(bU){return bU.Duration;},function(bU){return bz.map(bS,bU);})(bO),bz.max(bR)),bT=bu.map(function(bU){return R.Prolong(bQ,bU);},bO),R.Def(bQ,function(bU){bu.iter(function(bV){bV.Compute(bU);},bT);}));};R.Prolong=function(bN,bO){var bP,bQ,bR;bP=bO.Compute;bQ=bO.Duration;bR=bL.Create(function(){return bO.Compute(bO.Duration);});return{Compute:function(bS){return bS>=bQ?bR.e():bP(bS);},Duration:bN};};R.Const=function(bN){return R.Def(0,function(){return bN;});};R.Def=function(bN,bO){return{Compute:bO,Duration:bN};};R.Finalize=function(bN){var bO,bP;bO=o.ToArray(bN.$0);(bP=function(bQ){bQ.$==0?bQ.$0():null;},function(bQ){bu.iter(bP,bQ);})(bO);};R.List=function(bN){return bN.$0;};S=d.Trans=bt.Class({Copy:function(bN,bO,bP,bQ){var bR,bS,bT,bU,bV;bR=this;bS=bI.DefaultArg(bN,bt.Curried2(function(bW,bX){return bR.TChange(bW,bX);}));bT=bI.DefaultArg(bO,this.get_TEnter());bU=bI.DefaultArg(bP,this.get_TExit());bV=bI.DefaultArg(bQ,this.get_TFlags());return new S.New$3(function(bW,bX){return(bS(bW))(bX);},bT,bU,bV);},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bN,bO){return this.change(bN,bO);}},null,S);S.New=bt.Ctor(function(bN,bO,bP){S.New$3.call(this,bN,bA.Equals(bO,null)?Q.Const:bO,bA.Equals(bP,null)?Q.Const:bP,1|(bA.Equals(bO,null)?0:2)|(bA.Equals(bP,null)?0:4));},S);S.New$1=bt.Ctor(function(bN){S.New$3.call(this,bN,Q.Const,Q.Const,1);},S);S.New$2=bt.Ctor(function(){S.New$3.call(this,function(bN,bO){return Q.Const(bO);},Q.Const,Q.Const,0);},S);S.New$3=bt.Ctor(function(bN,bO,bP,bQ){this.change=bN;this.enter=bO;this.exit=bP;this.flags=bQ;null;},S);S.Exit=function(bN,bO){return bO.Copy(null,null,{$:1,$0:bN},{$:1,$0:bO.get_TFlags()|4});};S.Enter=function(bN,bO){return bO.Copy(null,{$:1,$0:bN},null,{$:1,$0:bO.get_TFlags()|2});};S.Change=function(bN,bO){return bO.Copy({$:1,$0:bN},null,null,{$:1,$0:bO.get_TFlags()|1});};S.Create=function(bN){return new S.New$1(function(bO,bP){return(bN(bO))(bP);});};S.Trivial=function(){return new S.New$2();};S.CanAnimateExit=function(bN){var bO;bO=bN.get_TFlags();return(bO&4)!==0;};S.CanAnimateEnter=function(bN){var bO;bO=bN.get_TFlags();return(bO&2)!==0;};S.CanAnimateChange=function(bN){var bO;bO=bN.get_TFlags();return(bO&1)!==0;};S.AnimateExit=function(bN,bO){return(bN.get_TExit())(bO);};S.AnimateEnter=function(bN,bO){return(bN.get_TEnter())(bO);};S.AnimateChange=function(bN,bO,bP){return bN.TChange(bO,bP);};T.$cctor=bt.Cctor(function(){T.CubicInOut=O.Custom(function(bN){var bO;bO=bN*bN;return 3*bO-2*(bO*bN);});});U=d.AnimatedAttrNode=bt.Class({sync:function(bN){this.dirty?(bE.iter(this.push(bN),this.logical),this.visible=this.logical,this.dirty=false):null;},pushVisible:function(bN,bO){this.visible={$:1,$0:bO};this.dirty=true;(this.push(bN))(bO);},NChanged:function(){return this.updates;},NInit:function(bN){},NSync:function(bN){},NGetExitAnim:function(bN){var bO,bP,bQ,bR,bS;bO=this;bP=(bQ=this.visible,(bQ!=null?bQ.$==1:false)?(bR=(bS=S.AnimateExit(this.tr,bQ.$0),((bt.Curried2(Q.Map))((bt.Curried2(function(bT,bU){bO.pushVisible(bT,bU);}))(bN)))(bS)),Q.Pack(bR)):Q.get_Empty());return((bt.Curried2(Q.WhenDone))(function(){bO.dirty=true;bO.visible=null;}))(bP);},NGetEnterAnim:function(bN){var bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ;bO=this;bP=(bQ=[this.visible,this.logical],((bS=bQ[0],bS!=null?bS.$==1:false)?(bT=bQ[1],bT!=null?bT.$==1:false)?this.dirty?(bR=[bQ[1].$0,bQ[0].$0],true):false:false:false)?(bU=(bV=S.AnimateChange(this.tr,bR[1],bR[0]),((bt.Curried2(Q.Map))((bt.Curried2(function(b0,b1){bO.pushVisible(b0,b1);}))(bN)))(bV)),Q.Pack(bU)):(bQ[0]==null?(bX=bQ[1],bX!=null?bX.$==1:false)?true:false:false)?(bY=(bZ=S.AnimateEnter(this.tr,bQ[1].$0),((bt.Curried2(Q.Map))((bt.Curried2(function(b0,b1){bO.pushVisible(b0,b1);}))(bN)))(bZ)),Q.Pack(bY)):Q.get_Empty());return((bt.Curried2(Q.WhenDone))(function(){bO.sync(bN);}))(bP);},NGetChangeAnim:function(bN){var bO,bP,bQ,bR,bS,bT,bU,bV;bO=this;bP=(bQ=[this.visible,this.logical],((bS=bQ[0],bS!=null?bS.$==1:false)?(bT=bQ[1],bT!=null?bT.$==1:false)?this.dirty?(bR=[bQ[1].$0,bQ[0].$0],true):false:false:false)?(bU=(bV=S.AnimateChange(this.tr,bR[1],bR[0]),((bt.Curried2(Q.Map))((bt.Curried2(function(bW,bX){bO.pushVisible(bW,bX);}))(bN)))(bV)),Q.Pack(bU)):Q.get_Empty());return((bt.Curried2(Q.WhenDone))(function(){bO.sync(bN);}))(bP);}},null,U);U.New=bt.Ctor(function(bN,bO,bP){var bQ;bQ=this;this.tr=bN;this.push=bP;this.logical=null;this.visible=null;this.dirty=true;this.updates=((bt.Curried2(x.Map))(function(bR){bQ.logical={$:1,$0:bR};bQ.dirty=true;}))(bO);null;},U);V=d.DynamicAttrNode=bt.Class({NInit:function(bN){this.init(bN);},NChanged:function(){return this.updates;},NSync:function(bN){this.dirty?((this.push(bN))(this.value),this.dirty=false):null;},NGetExitAnim:function(bN){return Q.get_Empty();},NGetEnterAnim:function(bN){return Q.get_Empty();},NGetChangeAnim:function(bN){return Q.get_Empty();}},null,V);V.New=bt.Ctor(function(bN,bO,bP){var bQ;bQ=this;this.init=bO;this.push=bP;this.value=void 0;this.dirty=true;this.updates=((bt.Curried2(x.Map))(function(bR){bQ.value=bR;bQ.dirty=true;}))(bN);null;},V);W=d.AttrProxy=bt.Class({},null,W);W.Handler=function(bN,bO){return _0.Static(function(bP){bP.addEventListener(bN,bO(bP),false);});};W.Concat=function(bN){var bO,bP,bQ;bO=bu.ofSeq(bN);return(bP=_0.EmptyAttr(),bQ=bt.Curried2(W.Append),function(bR){return e.MapReduce(a.id,bP,bQ,bR);})(bO);};W.Append=function(bN,bO){return _0.Mk(bN.Flags|bO.Flags,_0.AppendTree(bN.Tree,bO.Tree));};W.Create=function(bN,bO){return _0.Static(function(bP){q.SetAttr(bP,bN,bO);});};W.New=function(bN,bO){return new W({Flags:bN,Tree:bO});};Z=Y.Dyn=bt.Class({},null,Z);Z.New=function(bN,bO,bP,bQ){var bR;return new Z((bR={DynElem:bN,DynFlags:bO,DynNodes:bP},bt.SetOptional(bR,"OnAfterRender",bQ),bR));};_0.Static=function(bN){return _0.Mk(0,{$:3,$0:bN});};_0.Dynamic=function(bN,bO,bP){var bQ;bQ={$:1,$0:new V.New(bN,bO,bP)};return _0.Mk(0,bQ);};_0.Animated=function(bN,bO,bP){var bQ,bR;bQ=new U.New(bN,bO,bP);bR=4;S.CanAnimateEnter(bN)?void(bR=bR|1):null;S.CanAnimateExit(bN)?void(bR=bR|2):null;return _0.Mk(bR,{$:1,$0:bQ});};_0.EmptyAttr=function(){_2.$cctor();return _2.EmptyAttr;};_0.Mk=function(bN,bO){return W.New(bN,bO);};_0.AppendTree=function(bN,bO){var bP;bP=[bN,bO];return bP[0].$==0?bP[1]:bP[1].$==0?bP[0]:{$:2,$0:bN,$1:bO};};_0.GetChangeAnim=function(bN){return _0.GetAnim(bN,bt.Curried2(function(bO,bP){return bO.NGetChangeAnim(bP);}));};_0.GetExitAnim=function(bN){return _0.GetAnim(bN,bt.Curried2(function(bO,bP){return bO.NGetExitAnim(bP);}));};_0.GetEnterAnim=function(bN){return _0.GetAnim(bN,bt.Curried2(function(bO,bP){return bO.NGetEnterAnim(bP);}));};_0.GetAnim=function(bN,bO){var bP,bQ;bP=(bQ=function(bR){return(bO(bR))(bN.DynElem);},function(bR){return bu.map(bQ,bR);})(bN.DynNodes);return Q.Concat(bP);};_0.Updates=function(bN){var bO,bP,bQ;bO=bt.Curried2(function(bR,bS){return x.Map2(bt.Curried2(function(){}),bR,bS);});return(bP=function(bR){return bR.NChanged();},bQ=x.Const(),function(bR){return e.MapReduce(bP,bQ,bO,bR);})(bN.DynNodes);};_0.Insert=function(bN,bO){var bP,bQ,bR=[],bS=[];bP=function(bT){var bU;bT.$==1?(bU=bT.$0,bU.NInit(bN),bR.push(bU)):bT.$==2?(bP(bT.$0),bP(bT.$1)):bT.$==3?bT.$0(bN):bT.$==4?bS.push(bT.$0):null;};bP(bO.Tree);bQ=bR.slice(0);return Z.New(bN,bO.Flags,bQ,bS.length===0?null:{$:1,$0:function(bT){bz.iter(function(bU){bU(bT);},bS);}});};_0.Sync=function(bN,bO){var bP;(bP=function(bQ){bQ.NSync(bN);},function(bQ){bu.iter(bP,bQ);})(bO.DynNodes);};_0.HasExitAnim=function(bN){return(bN.DynFlags&2)!==0;};_0.HasEnterAnim=function(bN){return(bN.DynFlags&1)!==0;};_0.HasChangeAnim=function(bN){return(bN.DynFlags&4)!==0;};_1.ValidateForm=function(){return _1.OnAfterRender(function(bN){a.H5F?a.H5F.setup(bN):void 0;});};_1.Value=function(bN){var bO;return _1.CustomValue(bN,a.id,(bO=function(bP){return{$:1,$0:bP};},function(bP){return bO(a.id(bP));}));};_1.ContentEditableHtml=function(bN){var bO;bO=_1.CustomVar(bN,bt.Curried2(function(bP,bQ){bP.innerHTML=bQ;}),function(bP){return{$:1,$0:bP.innerHTML};});return((bt.Curried2(W.Append))(W.Create("contenteditable","true")))(bO);};_1.ContentEditableText=function(bN){var bO;bO=_1.CustomVar(bN,bt.Curried2(function(bP,bQ){bP.textContent=bQ;}),function(bP){return{$:1,$0:bP.textContent};});return((bt.Curried2(W.Append))(W.Create("contenteditable","true")))(bO);};_1.CustomValue=function(bN,bO,bP){return _1.CustomVar(bN,bt.Curried2(function(bQ,bR){bQ.value=bO(bR);}),function(bQ){return bP(bQ.value);});};_1.CustomVar=function(bN,bO,bP){var bQ;bQ=bt.Curried2(function(bR){bN.RUpdateMaybe(function(bS){var bT,bU;bT=bP(bR);return((bT!=null?bT.$==1:false)?!bA.Equals(bT.$0,bS)?(bU=[bT,bT.$0],true):false:false)?bU[0]:null;});});return W.Concat([_1.Handler("change",bQ),_1.Handler("input",bQ),_1.Handler("keypress",bQ),_1.DynamicCustom(bt.Curried2(function(bR,bS){var bT,bU;bT=bP(bR);((bT!=null?bT.$==1:false)?bA.Equals(bT.$0,bS)?(bU=bT.$0,true):false:false)?null:(bO(bR))(bS);}),bN.RView())]);};_1.DynamicProp=function(bN,bO){return _0.Dynamic(bO,function(){},bt.Curried2(function(bP,bQ){bP[bN]=bQ;}));};_1.DynamicPred=function(bN,bO,bP){var bQ;bQ=x.Map2(bt.Curried2(function(bR,bS){return[bR,bS];}),bO,bP);return _0.Dynamic(bQ,function(){},bt.Curried2(function(bR,bS){bS[0]?q.SetAttr(bR,bN,bS[1]):q.RemoveAttr(bR,bN);}));};_1.DynamicClass=function(bN,bO,bP){return _0.Dynamic(bO,function(){},bt.Curried2(function(bQ,bR){bP(bR)?q.AddClass(bQ,bN):q.RemoveClass(bQ,bN);}));};_1.OnAfterRenderView=function(bN,bO){var bP,bQ,bR;bP=h.Id();bQ=_1.OnAfterRender(function(bS){(bO(bS))(bS[bP]);});bR=_1.DynamicCustom(bt.Curried2(function(bS,bT){bS[bP]=bT;}),bN);return W.Append(bQ,bR);};_1.OnAfterRender=function(bN){return _0.Mk(0,{$:4,$0:bN});};_1.HandlerView=function(bN,bO,bP){return _0.Static(function(bQ){var bR;bR=bP(bQ);bQ.addEventListener(bN,function(bS){var bT;bT=bR(bS);return x.Get(bT,bO);},false);});};_1.Handler=function(bN,bO){return _0.Static(function(bP){bP.addEventListener(bN,bO(bP),false);});};_1.DynamicStyle=function(bN,bO){return _0.Dynamic(bO,function(){},bt.Curried2(function(bP,bQ){q.SetStyle(bP,bN,bQ);}));};_1.DynamicCustom=function(bN,bO){return _0.Dynamic(bO,function(){},bN);};_1.Dynamic=function(bN,bO){return _0.Dynamic(bO,function(){},bt.Curried2(function(bP,bQ){q.SetAttr(bP,bN,bQ);}));};_1.AnimatedStyle=function(bN,bO,bP,bQ){return _0.Animated(bO,bP,bt.Curried2(function(bR,bS){q.SetStyle(bR,bN,bQ(bS));}));};_1.Animated=function(bN,bO,bP,bQ){return _0.Animated(bO,bP,bt.Curried2(function(bR,bS){q.SetAttr(bR,bN,bQ(bS));}));};_1.Class=function(bN){return _0.Static(function(bO){q.AddClass(bO,bN);});};_1.Style=function(bN,bO){return _0.Static(function(bP){q.SetStyle(bP,bN,bO);});};_2.$cctor=bt.Cctor(function(){_2.EmptyAttr=_0.Mk(0,{$:0});});_3=X.DocNode=bt.Class({},null,_3);_4=d.DocElemNode=bt.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bN){return this.ElKey===bN.ElKey;}},null,_4);_4.New=function(bN,bO,bP,bQ,bR,bS){var bT;return new _4((bT={Attr:bN,Children:bO,El:bQ,ElKey:bR},bt.SetOptional(bT,"Delimiters",bP),bt.SetOptional(bT,"Render",bS),bT));};_6=_5.DomNodes=bt.Class({},null,_6);_6.FoldBack=function(bN,bO,bP){return bu.foldBack(bN,bO.$0,bP);};_6.Iter=function(bN,bO){bu.iter(bN,bO.$0);};_6.Except=function(bN,bO){var bP,bQ,bR;bP=bN.$0;bQ=(bR=function(bS){var bT;return(bT=function(bU){return!(bS===bU);},function(bU){return bz.forall(bT,bU);})(bP);},function(bS){return bu.filter(bR,bS);})(bO.$0);return new _6({$:0,$0:bQ});};_6.DocChildren=function(bN){var bO,bP=[];bO=function(bQ){bQ.$==2?bO(bQ.$0.Current):bQ.$==1?bP.push(bQ.$0.El):bQ.$==3?null:bQ.$==5?bP.push(bQ.$0):bQ.$==4?bP.push(bQ.$0.Text):(bO(bQ.$0),bO(bQ.$1));};bO(bN.Children);return new _6({$:0,$0:bP.slice(0)});};_6.Children=function(bN,bO){var bP,bQ,bR;if(bO!=null?bO.$==1:false){var bS=a.Array.prototype.constructor.apply(a.Array,[]);bQ=bO.$0[0].nextSibling;while(bQ!==bO.$0[1]){bS.push(bQ);bQ=bQ.nextSibling;}bP=new _6({$:0,$0:bS});}else bP=new _6({$:0,$0:bu.init(bN.childNodes.length,(bR=bN.childNodes,function(bT){return bR[bT];}))});return bP;};_7=_5.NodeSet=bt.Class({},null,_7);_7.ToArray=function(bN){return i.ToArray(bN.$0);};_7.get_Empty=function(){return new _7({$:0,$0:new by.New$3()});};_7.IsEmpty=function(bN){return bN.$0.get_Count()===0;};_7.Intersect=function(bN,bO){return new _7({$:0,$0:i.Intersect(bN.$0,bO.$0)});};_7.Except=function(bN,bO){var bP;bP=bN.$0;return new _7({$:0,$0:i.Except(bP,bO.$0)});};_7.FindAll=function(bN){var bO,bP=[];bO=function(bQ){var bR;bQ.$==0?(bO(bQ.$0),bO(bQ.$1)):bQ.$==1?(bR=bQ.$0,bP.push(bR),bO(bR.Children)):bQ.$==2?bO(bQ.$0.Current):null;};bO(bN);return new _7({$:0,$0:new by.New$2(bP.slice(0))});};_7.Filter=function(bN,bO){return new _7({$:0,$0:i.Filter(bN,bO.$0)});};_8=_5.RunState=bt.Class({},null,_8);_8.New=function(bN,bO){return new _8({PreviousNodes:bN,Top:bO});};_9.UpdateTextNode=function(bN,bO){bN.Value=bO;bN.Dirty=true;};_9.CreateTextNode=function(){return{Text:q.CreateText(""),Dirty:false,Value:""};};_9.UpdateEmbedNode=function(bN,bO){bN.Current=bO;bN.Dirty=true;};_9.CreateEmbedNode=function(){return{Current:new _3({$:3}),Dirty:false};};_9.PerformAnimatedUpdate=function(bN,bO){return bB.Delay(function(){var bP,bQ,bR,bS,bT;bP=_7.FindAll(bO);bQ=_9.ComputeChangeAnim(bN,bP);bR=_9.ComputeEnterAnim(bN,bP);bS=_9.ComputeExitAnim(bN,bP);bT=Q.Play(Q.Append(bQ,bS));return bB.Bind(bT,function(){var bU;_9.SyncElemNode(bN.Top);bU=Q.Play(bR);return bB.Bind(bU,function(){bN.PreviousNodes=bP;return bB.Return(null);});});});};_9.ComputeEnterAnim=function(bN,bO){var bP,bQ,bR,bS,bT;bP=(bQ=(bR=(bS=((bt.Curried2(_7.Filter))(function(bU){return _0.HasEnterAnim(bU.Attr);}))(bO),((bt.Curried2(_7.Except))(bN.PreviousNodes))(bS)),_7.ToArray(bR)),(bT=function(bU){return _0.GetEnterAnim(bU.Attr);},function(bU){return bu.map(bT,bU);})(bQ));return Q.Concat(bP);};_9.ComputeChangeAnim=function(bN,bO){var bP,bQ,bR,bS,bT,bU,bV;bP=(bt.Curried2(_7.Filter))(function(bW){return _0.HasChangeAnim(bW.Attr);});bQ=(bR=(bS=(bT=bP(bN.PreviousNodes),bU=bP(bO),_7.Intersect(bT,bU)),_7.ToArray(bS)),(bV=function(bW){return _0.GetChangeAnim(bW.Attr);},function(bW){return bu.map(bV,bW);})(bR));return Q.Concat(bQ);};_9.ComputeExitAnim=function(bN,bO){var bP,bQ,bR,bS,bT;bP=(bQ=(bR=(bS=((bt.Curried2(_7.Filter))(function(bU){return _0.HasExitAnim(bU.Attr);}))(bN.PreviousNodes),((bt.Curried2(_7.Except))(bO))(bS)),_7.ToArray(bR)),(bT=function(bU){return _0.GetExitAnim(bU.Attr);},function(bU){return bu.map(bT,bU);})(bQ));return Q.Concat(bP);};_9.CreateDelimitedRunState=function(bN,bO,bP){return _8.New(_7.get_Empty(),_9.CreateDelimitedElemNode(bN,bO,_0.EmptyAttr(),bP));};_9.CreateRunState=function(bN,bO){return _8.New(_7.get_Empty(),_9.CreateElemNode(bN,_0.EmptyAttr(),bO));};_9.CreateDelimitedElemNode=function(bN,bO,bP,bQ){var bR,bS;bR=bN.parentNode;_9.LinkPrevElement(bO,bQ);bS=_0.Insert(bR,bP);return _4.New(bS,bQ,{$:1,$0:[bN,bO]},bR,h.Int(),bt.GetOptional(bS.OnAfterRender));};_9.CreateElemNode=function(bN,bO,bP){var bQ;_9.LinkElement(bN,bP);bQ=_0.Insert(bN,bO);return _4.New(bQ,bP,null,bN,h.Int(),bt.GetOptional(bQ.OnAfterRender));};_9.SyncElemNode=function(bN){_9.SyncElement(bN);_9.Sync(bN.Children);_9.AfterRender(bN);};_9.Sync=function(bN){var bO;bO=function(bP){var bQ,bR;bP.$==1?(bQ=bP.$0,_9.SyncElement(bQ),bO(bQ.Children),_9.AfterRender(bQ)):bP.$==2?bO(bP.$0.Current):bP.$==3?null:bP.$==5?null:bP.$==4?(bR=bP.$0,bR.Dirty?(bR.Text.nodeValue=bR.Value,bR.Dirty=false):null):(bO(bP.$0),bO(bP.$1));};bO(bN);};_9.AfterRender=function(bN){var bO;bO=bt.GetOptional(bN.Render);(bO!=null?bO.$==1:false)?(bO.$0(bN.El),bt.SetOptional(bN,"Render",null)):null;};_9.LinkPrevElement=function(bN,bO){_9.InsertDoc(bN.parentNode,bO,new r({$:1,$0:bN}));};_9.LinkElement=function(bN,bO){_9.InsertDoc(bN,bO,new r({$:0}));};_9.SyncElement=function(bN){_0.Sync(bN.El,bN.Attr);(function(bO){var bP;bP=function(bQ){var bR;return bQ.$==0?bP(bQ.$0)?true:bP(bQ.$1):bQ.$==2?(bR=bQ.$0,bR.Dirty?true:bP(bR.Current)):false;};return bP(bO.Children);}(bN)?_9.DoSyncElement(bN):null);};_9.DoSyncElement=function(bN){var bO,bP,bQ,bR,bS,bT,bU,bV=bN.El;bO=bt.Curried2(function(bW,bX){var bY;return bW.$==1?new r({$:1,$0:bW.$0.El}):bW.$==2?(bY=bW.$0,bY.Dirty?(bY.Dirty=false,_9.InsertDoc(bV,bY.Current,bX)):(bO(bY.Current))(bX)):bW.$==3?bX:bW.$==4?new r({$:1,$0:bW.$0.Text}):bW.$==5?new r({$:1,$0:bW.$0}):(bO(bW.$0))((bO(bW.$1))(bX));});bP=_6.DocChildren(bN);bQ=(bR=_6.Children(bN.El,bt.GetOptional(bN.Delimiters)),((bt.Curried2(_6.Except))(bP))(bR));((bt.Curried2(function(bW,bX){_6.Iter(bW,bX);}))((bS=bN.El,function(bW){q.RemoveNode(bS,bW);})))(bQ);bT=(bU=bt.GetOptional(bN.Delimiters),(bU!=null?bU.$==1:false)?new r({$:1,$0:bU.$0[1]}):new r({$:0}));(bO(bN.Children))(bT);};_9.InsertDoc=function(bN,bO,bP){var bQ;return bO.$==1?_9.InsertNode(bN,bO.$0.El,bP):bO.$==2?(bQ=bO.$0,bQ.Dirty=false,_9.InsertDoc(bN,bQ.Current,bP)):bO.$==3?bP:bO.$==4?_9.InsertNode(bN,bO.$0.Text,bP):bO.$==5?_9.InsertNode(bN,bO.$0,bP):_9.InsertDoc(bN,bO.$0,_9.InsertDoc(bN,bO.$1,bP));};_9.InsertNode=function(bN,bO,bP){q.InsertAt(bN,bP,bO);return new r({$:1,$0:bO});};_=d.CheckedInput=bt.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_);$=d.Doc=bt.Class({ReplaceInDom:function(bN){var bO;bO=a.document.createTextNode("");bN.parentNode.replaceChild(bO,bN);$.RunBefore(bO,this);}},null,$);$.Append=function(bN,bO){var bP,bQ,bR;bP=(bQ=bN.updates,bR=bO.updates,(((bt.Curried3(x.Map2))(bt.Curried2(function(){})))(bQ))(bR));return((bt.Curried2($.Mk))(new _3({$:0,$0:bN.docNode,$1:bO.docNode})))(bP);};$.Concat=function(bN){var bO,bP,bQ;bO=bu.ofSeq(bN);return(bP=$.Empty(),bQ=bt.Curried2($.Append),function(bR){return e.MapReduce(a.id,bP,bQ,bR);})(bO);};$.Empty=function(){var bN,bO;bN=new _3({$:3});bO=x.Const();return $.Mk(bN,bO);};$.TextNode=function(bN){var bO,bP;bO=new _3({$:5,$0:q.CreateText(bN)});bP=x.Const();return $.Mk(bO,bP);};$.Verbatim=function(bN){var bO,bP,bQ,bR;bO=(bP=a.jQuery.parseHTML(bN),bA.Equals(bP,null)?[]:bP);bQ=e.MapReduce(function(bS){return new _3({$:1,$0:_9.CreateElemNode(bS,_0.EmptyAttr(),new _3({$:3}))});},new _3({$:3}),bt.Curried2(function(bS,bT){return new _3({$:0,$0:bS,$1:bT});}),bO);bR=x.Const();return $.Mk(bQ,bR);};$.SvgElementMixed=function(bN,bO){var bP;bP=$.MixedNodes(bO);return $.SvgElement(bN,bP[0],bP[1]);};$.SvgElement=function(bN,bO,bP){var bQ,bR,bS;bQ=W.Concat(bO);bR=$.Concat(bP);bS=q.CreateSvgElement(bN);return ba.New(bS,bQ,bR);};$.ElementMixed=function(bN,bO){var bP;bP=$.MixedNodes(bO);return $.Element(bN,bP[0],bP[1]);};$.ConcatMixed=function(bN){return $.Concat(bz.map($.ToMixedDoc,bN));};$.MixedNodes=function(bN){var bO=new bH.New$2(),bP=new bH.New$2(),bQ=bG.Get(bN);try{while(bQ.MoveNext()){var bR;bR=bQ.Current();bR instanceof W?bO.Add(bR):bP.Add($.ToMixedDoc(bR));}}finally{"Dispose"in bQ?bQ.Dispose():null;}return[bO,bP];};$.ToMixedDoc=function(bN){var bO,bP,bQ,bR;return bN instanceof $?bN:typeof bN=="string"?$.TextNode(bN):bN instanceof a.Element?(bO=$.Static(bN),a.id(bO)):bN instanceof x?(bP=$.EmbedView(x.Map($.ToMixedDoc,bN)),a.id(bP)):bN instanceof y?(bQ=$.EmbedView((bR=bN.get_View(),x.Map($.ToMixedDoc,bR))),a.id(bQ)):bA.Equals(bN,null)?$.Empty():$.TextNode(a.String(bN));};$.Element=function(bN,bO,bP){var bQ,bR,bS;bQ=W.Concat(bO);bR=$.Concat(bP);bS=q.CreateElement(bN);return ba.New(bS,bQ,bR);};$.Radio=function(bN,bO,bP){var bQ,bR,bS,bT,bU,bV,bW,bX;bQ=q.CreateElement("input");bQ.addEventListener("click",function(){return bP.RSet(bO);},false);bR=(bS=bP.RView(),x.Map(function(bY){return bA.Equals(bY,bO);},bS));bT=_1.DynamicProp("checked",bR);bU=bt.Curried2(W.Create);bV=(bW=bC.append(bC.ofArray([(bU("type"))("radio"),(bU("name"))(bP.RId()),bT]),bC.ofSeq(bN)),W.Concat(bW));bX=$.Empty();return ba.New(bQ,bV,bX);};$.LinkView=function(bN,bO,bP,bQ){var bR,bS,bT,bU;bR=_1.HandlerView("click",bP,bt.Curried2(function(){return bQ;}));bS=W.Concat(bz.append([bR,W.Create("href","#")],bO));bT=q.CreateElement("a");bU=$.TextNode(bN);return ba.New(bT,bS,bU);};$.Link=function(bN,bO,bP){var bQ,bR,bS,bT;bQ=(bR=W.Concat(bO),((bt.Curried2(W.Append))(W.Create("href","#")))(bR));bS=$.Clickable("a",bP);bT=$.TextNode(bN);return ba.New(bS,bQ,bT);};$.ButtonView=function(bN,bO,bP,bQ){var bR,bS,bT,bU;bR=_1.HandlerView("click",bP,bt.Curried2(function(){return bQ;}));bS=W.Concat(bz.append([bR],bO));bT=q.CreateElement("button");bU=$.TextNode(bN);return ba.New(bT,bS,bU);};$.Button=function(bN,bO,bP){var bQ,bR,bS;bQ=W.Concat(bO);bR=$.Clickable("button",bP);bS=$.TextNode(bN);return ba.New(bR,bQ,bS);};$.Clickable=function(bN,bO){var bP;bP=q.CreateElement(bN);bP.addEventListener("click",function(bQ){bQ.preventDefault();return bO();},false);return bP;};$.CheckBoxGroup=function(bN,bO,bP){var bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1;bQ=bP.RView();bR=function(b2){bP.RUpdate(function(b3){var b4,b5;b4=b2?bC.append(b3,bC.ofArray([bO])):bC.filter(function(b6){return!bA.Equals(b6,bO);},b3);b5=bz.distinct(b4);return bC.ofSeq(b5);});};bS=(bT=(bU=function(b2){return bA.Equals(b2,bO);},function(b2){return bz.exists(bU,b2);}),x.Map(bT,bQ));bV=(bW=bC.append(bC.ofArray([W.Create("type","checkbox"),(bX=bP.RId(),W.Create("name",bX)),(bY=h.Id(),W.Create("value",bY)),_1.DynamicProp("checked",bS)]),bC.ofSeq(bN)),W.Concat(bW));bZ=q.CreateElement("input");b0=function(){bR(bZ.checked);};bZ.addEventListener("click",b0,false);b1=$.Empty();return ba.New(bZ,bV,b1);};$.CheckBox=function(bN,bO){var bP,bQ,bR,bS;bP=q.CreateElement("input");bQ=function(){bO.RSet(bP.checked);};bP.addEventListener("click",bQ,false);bR=W.Concat(bC.ofSeq(bz.delay(function(){return bz.append(bN,bz.delay(function(){return bz.append([W.Create("type","checkbox")],bz.delay(function(){return[_1.DynamicProp("checked",bO.RView())];}));}));})));bS=$.Empty();return ba.New(bP,bR,bS);};$.SelectDynOptional=function(bN,bO,bP,bQ,bR){var bS;bS=((bt.Curried2(x.Map))(function(bT){return new bC.T({$:1,$0:null,$1:bC.map(function(bU){return{$:1,$0:bU};},bT)});}))(bQ);return $.SelectDyn(bN,function(bT){return(bT!=null?bT.$==1:false)?bP(bT.$0):bO;},bS,bR);};$.SelectOptional=function(bN,bO,bP,bQ,bR){var bS;bS=new bC.T({$:1,$0:null,$1:bC.map(function(bT){return{$:1,$0:bT};},bQ)});return $.Select(bN,function(bT){return(bT!=null?bT.$==1:false)?bP(bT.$0):bO;},bS,bR);};$.Select=function(bN,bO,bP,bQ){return $.SelectImpl(bN,bO,function(bR){var bS,bT;bR[0]=bP;bS=(bT=bt.Curried2(function(bU,bV){var bW,bX;bW=bC.ofArray([W.Create("value",a.String(bU))]);bX=bC.ofArray([$.TextNode(bO(bV))]);return $.Element("option",bW,bX);}),function(bU){return bC.mapi(bT,bU);})(bP);return $.Concat(bS);},bQ);};$.SelectDyn=function(bN,bO,bP,bQ){return $.SelectImpl(bN,bO,function(bR){var bS;bS=((bt.Curried2(x.Map))(function(bT){var bU;bR[0]=bT;return(bU=bt.Curried2(function(bV,bW){return[bV,bW];}),function(bV){return bz.mapi(bU,bV);})(bT);}))(bP);return((bt.Curried2($.Convert))(function(bT){var bU,bV;bU=bC.ofArray([W.Create("value",a.String(bT[0]))]);bV=bC.ofArray([$.TextNode(bO(bT[1]))]);return $.Element("option",bU,bV);}))(bS);},bQ);};$.SelectImpl=function(bN,bO,bP,bQ){var bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4;bR=[new bC.T({$:0})];bS=function(b5){return b5.selectedIndex;};bT=bt.Curried2(function(b5,b6){b5.selectedIndex=b6;});bU=function(b5){return bR[0].get_Item(bS(b5));};bV=function(b5){return bz.findIndex(function(b6){return bA.Equals(b5,b6);},bR[0]);};bW=bt.Curried2(function(b5,b6){(bT(b5))(bV(b6));});bX=q.CreateElement("select");bY=(bZ=bQ.RView(),_1.DynamicCustom(bW,bZ));b0=function(){bQ.RUpdateMaybe(function(b5){var b6;b6=bU(bX);return bA.Equals(b5,b6)?null:{$:1,$0:b6};});};bX.addEventListener("change",b0,false);b1=(b2=(b3=W.Concat(bN),((bt.Curried2(W.Append))(bY))(b3)),((bt.Curried2(W.Append))(_1.OnAfterRender(function(b5){(bW(b5))(bQ.RGet());})))(b2));b4=bP(bR);return ba.New(bX,b1,b4);};$.InputArea=function(bN,bO){return $.InputInternal("textarea",function(){return bz.append(bN,[_1.Value(bO)]);});};$.FloatInput=function(bN,bO){var bP;bP=bt.Curried2(function(bQ,bR){var bS;return{$:1,$0:f.isBlank(bR)?(bQ.checkValidity?bQ.checkValidity():true)?new _({$:2,$0:bR}):new _({$:1,$0:bR}):(bS=+bR,a.isNaN(bS)?new _({$:1,$0:bR}):new _({$:0,$0:bS,$1:bR}))};});return $.InputInternal("input",function(bQ){return bz.append(bN,[_1.CustomValue(bO,function(bR){return bR.get_Input();},bP(bQ)),W.Create("type","number")]);});};$.FloatInputUnchecked=function(bN,bO){var bP;bP=function(bQ){var bR;return f.isBlank(bQ)?{$:1,$0:0}:(bR=+bQ,a.isNaN(bR)?null:{$:1,$0:bR});};return $.InputInternal("input",function(){return bz.append(bN,[bO.RGet()===0?W.Create("value","0"):_0.EmptyAttr(),_1.CustomValue(bO,a.String,bP),W.Create("type","number")]);});};$.IntInput=function(bN,bO){var bP;bP=bt.Curried2(function(bQ,bR){var bS;return{$:1,$0:f.isBlank(bR)?(bQ.checkValidity?bQ.checkValidity():true)?new _({$:2,$0:bR}):new _({$:1,$0:bR}):(bS=+bR,a.isNaN(bS)?new _({$:1,$0:bR}):new _({$:0,$0:bS,$1:bR}))};});return $.InputInternal("input",function(bQ){return bz.append(bN,[_1.CustomValue(bO,function(bR){return bR.get_Input();},bP(bQ)),W.Create("type","number"),W.Create("step","1")]);});};$.IntInputUnchecked=function(bN,bO){var bP;bP=function(bQ){var bR;return f.isBlank(bQ)?{$:1,$0:0}:(bR=+bQ,bR!==bR>>0?null:{$:1,$0:bR});};return $.InputInternal("input",function(){return bz.append(bN,[bO.RGet()===0?W.Create("value","0"):_0.EmptyAttr(),_1.CustomValue(bO,a.String,bP),W.Create("type","number"),W.Create("step","1")]);});};$.PasswordBox=function(bN,bO){return $.InputInternal("input",function(){return bz.append(bN,[_1.Value(bO),W.Create("type","password")]);});};$.Input=function(bN,bO){return $.InputInternal("input",function(){return bz.append(bN,[_1.Value(bO)]);});};$.InputInternal=function(bN,bO){var bP,bQ,bR;bP=q.CreateElement(bN);bQ=W.Concat(bO(bP));bR=$.Empty();return ba.New(bP,bQ,bR);};$.ConvertSeqBy=function(bN,bO,bP){var bQ;bQ=x.MapSeqCachedViewBy(bN,bO,bP);return $.Flatten(bQ);};$.ConvertSeq=function(bN,bO){var bP;bP=x.MapSeqCachedView(bN,bO);return $.Flatten(bP);};$.ConvertBy=function(bN,bO,bP){var bQ;bQ=x.MapSeqCachedBy(bN,bO,bP);return $.Flatten(bQ);};$.Convert=function(bN,bO){var bP;bP=x.MapSeqCached(bN,bO);return $.Flatten(bP);};$.Flatten=function(bN){var bO;bO=((bt.Curried2(x.Map))($.Concat))(bN);return $.EmbedView(bO);};$.TextView=function(bN){var bO,bP;bO=_9.CreateTextNode();bP=((bt.Curried2(x.Map))(function(bQ){_9.UpdateTextNode(bO,bQ);}))(bN);return((bt.Curried2($.Mk))(new _3({$:4,$0:bO})))(bP);};$.RunReplaceById=function(bN,bO){var bP;bP=q.Doc().getElementById(bN);bA.Equals(bP,null)?bI.FailWith("invalid id: "+bN):bO.ReplaceInDom(bP);};$.RunById=function(bN,bO){var bP;bP=q.Doc().getElementById(bN);bA.Equals(bP,null)?bI.FailWith("invalid id: "+bN):$.Run(bP,bO);};$.Run=function(bN,bO){var bP,bQ,bR,bS;bP=bO.docNode;_9.LinkElement(bN,bP);bQ=_9.CreateRunState(bN,bP);bR=m.StartProcessor(function(){return _9.PerformAnimatedUpdate(bQ,bP);});bS=bO.updates;x.Sink(bR,bS);};$.RunPrependById=function(bN,bO){var bP;bP=q.Doc().getElementById(bN);bA.Equals(bP,null)?bI.FailWith("invalid id: "+bN):$.RunPrepend(bP,bO);};$.RunPrepend=function(bN,bO){var bP;bP=a.document.createTextNode("");bN.insertBefore(bP,bN.firstChild);$.RunBefore(bP,bO);};$.RunAppendById=function(bN,bO){var bP;bP=q.Doc().getElementById(bN);bA.Equals(bP,null)?bI.FailWith("invalid id: "+bN):$.RunAppend(bP,bO);};$.RunAppend=function(bN,bO){var bP;bP=a.document.createTextNode("");bN.appendChild(bP);$.RunBefore(bP,bO);};$.RunAfterById=function(bN,bO){var bP;bP=q.Doc().getElementById(bN);bA.Equals(bP,null)?bI.FailWith("invalid id: "+bN):$.RunAfter(bP,bO);};$.RunAfter=function(bN,bO){var bP;bP=a.document.createTextNode("");bN.parentNode.insertBefore(bP,bN.nextSibling);$.RunBetween(bN,bP,bO);};$.RunBeforeById=function(bN,bO){var bP;bP=q.Doc().getElementById(bN);bA.Equals(bP,null)?bI.FailWith("invalid id: "+bN):$.RunBefore(bP,bO);};$.RunBefore=function(bN,bO){var bP;bP=a.document.createTextNode("");bN.parentNode.insertBefore(bP,bN);$.RunBetween(bP,bN,bO);};$.RunBetween=function(bN,bO,bP){var bQ,bR,bS;_9.LinkPrevElement(bO,bP.docNode);bQ=_9.CreateDelimitedRunState(bN,bO,bP.docNode);bR=m.StartProcessor(function(){return _9.PerformAnimatedUpdate(bQ,bP.docNode);});bS=bP.updates;x.Sink(bR,bS);};$.Async=function(bN){var bO,bP;bO=(bP=x.Const(bN),((bt.Curried2(x.MapAsync))(a.id))(bP));return $.EmbedView(bO);};$.BindView=function(bN,bO){return $.EmbedView(x.Map(bN,bO));};$.EmbedView=function(bN){var bO,bP,bQ;bO=_9.CreateEmbedNode();bP=(bQ=((bt.Curried2(x.Bind))(function(bR){_9.UpdateEmbedNode(bO,bR.docNode);return bR.updates;}))(bN),((bt.Curried2(x.Map))(function(){}))(bQ));return((bt.Curried2($.Mk))(new _3({$:2,$0:bO})))(bP);};$.Static=function(bN){var bO,bP;bO=_0.EmptyAttr();bP=$.Empty();return ba.New(bN,bO,bP);};$.Mk=function(bN,bO){return new $.New(bN,bO);};$.New=bt.Ctor(function(bN,bO){this.docNode=bN;this.updates=bO;null;},$);ba=d.Elt=bt.Class({AddClass:function(bN){return this.elt.className+=" "+bN;},SetStyle:function(bN,bO){this.elt.style[bN]=bO;},HasClass:function(bN){return(new a.RegExp("(\\s|^)"+bN+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bN){this.elt.className=this.elt.className.replace(new a.RegExp("(\\s|^)"+bN+"(\\s|$)")," ");},GetProperty:function(bN){return this.elt[bN];},SetProperty:function(bN,bO){this.elt[bN]=bO;},RemoveAttribute:function(bN){this.elt.removeAttribute(bN);},HasAttribute:function(bN){return this.elt.hasAttribute(bN);},GetAttribute:function(bN){return this.elt.getAttribute(bN);},SetAttribute:function(bN,bO){this.elt.setAttribute(bN,bO);},SetText:function(bN){var bO;this.get_DocElemNode().Children=new _3({$:3});bO=x.Const();y.Set(this.rvUpdates,bO);this.elt.textContent=bN;},GetText:function(){return this.elt.textContent;},SetValue:function(bN){this.elt.value=bN;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bN;this.get_DocElemNode().Children=new _3({$:3});bN=x.Const();y.Set(this.rvUpdates,bN);while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(bN){var bO,bP,bQ,bR,bS,bT;bO=this.get_DocElemNode();bO.Children=new _3({$:0,$0:bN.docNode,$1:bO.Children});bP=(bQ=y.Get(this.rvUpdates),bR=bN.updates,x.Map2(bt.Curried2(function(){}),bQ,bR));y.Set(this.rvUpdates,bP);bS=(bT=this.elt.firstChild,bA.Equals(bT,null)?new r({$:0}):new r({$:1,$0:bT}));_9.InsertDoc(this.elt,bN.docNode,bS);},Append:function(bN){var bO,bP,bQ,bR;bO=this.get_DocElemNode();bO.Children=new _3({$:0,$0:bO.Children,$1:bN.docNode});bP=(bQ=y.Get(this.rvUpdates),bR=bN.updates,x.Map2(bt.Curried2(function(){}),bQ,bR));y.Set(this.rvUpdates,bP);_9.InsertDoc(this.elt,bN.docNode,new r({$:0}));},get_DocElemNode:function(){var bN;bN=this.docNode$1;return bN.$==1?bN.$0:bI.FailWith("Elt: Invalid docNode");},OnAfterRenderView:function(bN,bO){var bP,bQ;bP=this;bQ=h.Id();this.Append($.BindView(function(bR){bP.elt[bQ]=bR;return $.Empty();},bN));return this.OnAfterRender(function(bR){(bO(bR))(bR[bQ]);});},OnAfterRender:function(bN){var bO,bP;bt.SetOptional(this.get_DocElemNode(),"Render",(bO=bt.GetOptional(this.get_DocElemNode().Render),(bO!=null?bO.$==1:false)?(bP=bO.$0,{$:1,$0:function(bQ){bP(bQ);bN(bQ);}}):{$:1,$0:bN}));return this;},onView:function(bN,bO,bP){var bQ;bQ=bP(this.elt);this.elt.addEventListener(bN,function(bR){var bS;bS=bQ(bR);return x.Get(bS,bO);},false);return this;},on:function(bN,bO){this.elt.addEventListener(bN,bO(this.elt),false);return this;}},$,ba);ba.New=function(bN,bO,bP){var bQ,bR,bS,bT,bU,bV;bQ=_9.CreateElemNode(bN,bO,bP.docNode);bR=y.Create$1(bP.updates);bS=_0.Updates(bQ.Attr);bT=(bU=((bt.Curried3(x.Map2))(bt.Curried2(function(){})))(bS),bV=bR.get_View(),x.Bind(bU,bV));return new ba.New$1(new _3({$:1,$0:bQ}),bT,bN,bR,bS);};ba.New$1=bt.Ctor(function(bN,bO,bP,bQ,bR){$.New.call(this,bN,bO);this.docNode$1=bN;this.elt=bP;this.rvUpdates=bQ;null;},ba);bb=d.Flow=bt.Class({get_Render:function(){return this.render;}},null,bb);bb.New=bt.Ctor(function(bN){bb.New$1.call(this,bt.Curried2(function(bO,bP){var bQ;bQ=bN(bP);y.Set(bO,bQ);}));},bb);bb.New$1=bt.Ctor(function(bN){this.render=bN;null;},bb);bb.get_Do=function(){return new bc.New();};bb.Static=function(bN){return new bb.New$1(bt.Curried2(function(bO,bP){y.Set(bO,bN);bP();}));};bb.Define=function(bN){return new bb.New(function(bO){return bN(function(bP){bO(bP);});});};bb.Embed=function(bN){var bO;bO=y.Create$1($.Empty());((bN.get_Render())(bO))(function(){});return $.EmbedView(bO.get_View());};bb.Return=function(bN){return new bb.New$1(bt.Curried2(function(bO,bP){bP(bN);}));};bb.Bind=function(bN,bO){return new bb.New$1(bt.Curried2(function(bP,bQ){((bN.get_Render())(bP))(function(bR){((bO(bR).get_Render())(bP))(bQ);});}));};bb.Map=function(bN,bO){return new bb.New$1(bt.Curried2(function(bP,bQ){((bO.get_Render())(bP))(function(bR){bQ(bN(bR));});}));};bc=d.FlowBuilder=bt.Class({ReturnFrom:function(bN){return bN;},Return:function(bN){return bb.Return(bN);},Bind:function(bN,bO){return bb.Bind(bN,bO);}},null,bc);bc.New=bt.Ctor(function(){},bc);be=bd.attr=bt.Class({},null,be);be.New=bt.Ctor(function(){},be);bg=bf.T=bt.Class({},null,bg);bf.Append=function(bN,bO){return new bg({$:0,$0:o.Append(bN.$0,bO.$0),$1:bD.FoldBack(bt.Curried3(function(bP,bQ,bR){return bR.Add(bP,bQ);}),bN.$1,bO.$1)});};bf.FromList=function(bN,bO){var bP,bQ;bP=(bQ=bu.ofList(bN),o.FromArray(bQ));return new bg({$:0,$0:bP,$1:bO});};bf.ToList=function(bN){var bO;return[(bO=o.ToArray(bN.$0),bC.ofArray(bO)),bN.$1];};bf.SameHash=function(bN,bO){return bf.NoHash(bN)===bf.NoHash(bO);};bf.MakeHash=function(bN){var bO,bP,bQ,bR,bS,bT;bO=bN.$1;bP=(bQ=(bR=o.ToArray(bN.$0),bu.map(function(bU){return a.encodeURIComponent(bU);},bR)),bv.concat("/",bQ));return bO.get_IsEmpty()?bP:bP+"?"+(bS=(bT=function(bU){var bV;bV=bI.KeyValue(bU);return a.encodeURIComponent(bV[0])+"="+a.encodeURIComponent(bV[1]);},function(bU){return bz.map(bT,bU);})(bO),bv.concat("&",bS));};bf.ParseHash=function(bN){var bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY;bO=bf.NoHash(bN);bP=(bQ=bO.indexOf(a.String.fromCharCode(63)),bQ===-1?[bO,""]:[bM.string(bO,null,{$:1,$0:bQ-1}),bM.string(bO,{$:1,$0:bQ+1},null)]);bR=bP[0];bS=(bT=bR===""?[]:(bU=bv.SplitChars(bR,[47],0),bu.map(function(bZ){return a.decodeURIComponent(bZ);},bU)),o.FromArray(bT));bV=(bW=(bX=bv.SplitChars(bP[1],[38],0),(bY=function(bZ){var b0,b1,b2;b0=bZ.indexOf(a.String.fromCharCode(61));return b0===-1?[a.decodeURIComponent(bZ),""]:[(b1=bM.string(bZ,null,{$:1,$0:b0-1}),a.decodeURIComponent(b1)),(b2=bM.string(bZ,{$:1,$0:b0+1},null),a.decodeURIComponent(b2))];},function(bZ){return bu.map(bY,bZ);})(bX)),bD.OfArray(bW));return new bg({$:0,$0:bS,$1:bV});};bf.NoHash=function(bN){return bv.StartsWith(bN,"#")?bN.substring(1):bN;};bi=bh.State=bt.Class({},null,bi);bi.New=function(bN,bO,bP,bQ){return new bi({Bodies:bN,CurrentRoute:bO,CurrentSite:bP,Selection:bQ});};bh.Install=function(bN,bO){function b1(b2){var b3,b4,b5;b3=bU(b2);b3.$==1?null:(b4=b3.$0,b5=bf.FromList(b3.$1,new bF.New([])),bh.OnGlobalRouteChange(bR,b4,b5));}var bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0;bP=bO.$0;bQ=bh.InstallMap({Des:function(b2){return bf.FromList(b2[0],b2[1]);},Ser:bf.ToList});bR=bi.New(void 0,bQ,0,void 0);bS=(bT=bt.Curried2(function(b2,b3){var b4;b4=b3.$0;return b3.$1({UpdateRoute:function(b5){bh.OnInternalSiteUpdate(bR,b4,b2,b5);}});}),function(b2){return t.Map(bT,b2);})(bO.$1);bR.Bodies=bh.ComputeBodies(bS);bU=function(b2){var b3;b3=bf.ToList(b2);return t.Lookup(bS,b3[0]);};bV=(bW=bU(y.Get(bQ)),bW.$==0?(bX=bW.$0,bR.CurrentSite=bX.RouteId,y.Create$1(bX.RouteValue)):(bY=(bP!=null?bP.$==1:false)?bP.$0:bI.FailWith("Site.Install fails on empty site"),y.Create$1(bY)));bR.Selection=bV;bZ=bV.get_View();((bt.Curried2(function(b2,b3){x.Sink(b2,b3);}))(function(b2){bh.OnSelectSite(bR,bN(b2));}))(bZ);b1(y.Get(bQ));b0=bQ.get_View();((bt.Curried2(function(b2,b3){x.Sink(b2,b3);}))(b1))(b0);return bV;};bh.OnSelectSite=function(bN,bO){var bP;bP=bO.$0;bN.CurrentSite!==bP?(bN.CurrentSite=bP,bN.Bodies.get_Item(bP).OnSelect()):null;};bh.OnInternalSiteUpdate=function(bN,bO,bP,bQ){var bR;bN.CurrentSite===bO?(bR=bf.Append(bf.FromList(bP,new bF.New([])),bQ),bh.SetCurrentRoute(bN,bR)):null;};bh.OnGlobalRouteChange=function(bN,bO,bP){bN.CurrentSite!==bO.RouteId?(bN.CurrentSite=bO.RouteId,y.Set(bN.Selection,bO.RouteValue)):null;bO.OnRouteChanged(bP);};bh.SetCurrentRoute=function(bN,bO){!bA.Equals(y.Get(bN.CurrentRoute),bO)?y.Set(bN.CurrentRoute,bO):null;};bh.ComputeBodies=function(bN){var bO,bP,bQ;bO=new bK.New$5();bP=t.ToArray(bN);(bQ=function(bR){bO.set_Item(bR.RouteId,bR);},function(bR){bu.iter(bQ,bR);})(bP);return bO;};bh.MergeRouters=function(bN){var bO,bP,bQ,bR,bS,bT;bO=bu.ofSeq(bN);bP=(bQ=(bR=function(bU){return bU.$1;},function(bU){return bz.map(bR,bU);})(bO),t.Merge(bQ));bS=(bT=function(bU){return bU.$0;},function(bU){return bz.tryPick(bT,bU);})(bO);return(bP!=null?bP.$==1:false)?{$:0,$0:bS,$1:bP.$0}:bI.FailWith("Invalid Site.Merge: need more prefix disambiguation");};bh.DefineRoute=function(bN,bO,bP){var bQ,bR,bS;bQ=y.Create$1(bO);bR=h.Int();bS=(bP({$:0,$0:bR}))(bQ);return{$:0,$0:{$:1,$0:bS},$1:t.Leaf({$:0,$0:bR,$1:function(bT){var bU;bU=bQ.get_View();((bt.Curried2(function(bV,bW){x.Sink(bV,bW);}))(function(bV){bT.UpdateRoute(bh.DoLink(bN,bV));}))(bU);return{OnRouteChanged:function(bV){var bW;bW=bh.DoRoute(bN,bV);y.Set(bQ,bW);},OnSelect:function(){bT.UpdateRoute(bh.DoLink(bN,y.Get(bQ)));},RouteId:bR,RouteValue:bS};}})};};bh.DoLink=function(bN,bO){var bP;bP=bN.Ser(bO);return bf.FromList(bP[0],bP[1]);};bh.DoRoute=function(bN,bO){return bN.Des(bf.ToList(bO));};bh.InstallMap=function(bN){function bU(bV){return bS(bQ());}var bO,bP,bQ,bR,bS,bT;bO=a.window;bP=bt.Curried2(function(bV,bW){return bA.Equals(bN.Ser(bV),bN.Ser(bW));});bQ=function(){var bV;return bN.Des((bV=bf.ParseHash(bO.location.hash),bf.ToList(bV)));};bR=y.Create$1(bQ());bS=function(bV){!(bP(y.Get(bR)))(bV)?y.Set(bR,bV):null;};bO.onpopstate=bU;bO.onhashchange=bU;bT=bR.get_View();((bt.Curried2(function(bV,bW){x.Sink(bV,bW);}))(function(bV){var bW,bX;bW=bf.MakeHash((bX=bN.Ser(bV),bf.FromList(bX[0],bX[1])));!bf.SameHash(bO.location.hash,bW)?bO.location.replace("#"+bW):null;}))(bT);return bR;};bj.Install=function(bN){return bh.InstallMap(bN);};bj.Create=function(bN,bO){var bP;return{Des:(bP=function(bQ){return bQ[0];},function(bQ){return bO(bP(bQ));}),Ser:function(bQ){return[bN(bQ),new bF.New([])];}};};bj.CreateWithQuery=function(bN,bO){return{Des:bO,Ser:bN};};bk.Route=function(bN,bO,bP){return bh.DefineRoute(bN,bO,bP);};bk.Prefix=function(bN,bO){return{$:0,$0:bO.$0,$1:t.Prefix(bN,bO.$1)};};bk.Merge=function(bN){return bh.MergeRouters(bN);};bk.Install=function(bN,bO){return bh.Install(bN,bO);};bk.Dir=function(bN,bO){var bP;bP=bk.Merge(bO);return bk.Prefix(bN,bP);};bm=bl.MousePosSt=bt.Class({},null,bm);bm.New=function(bN,bO){return new bm({Active:bN,PosV:bO});};bn=bl.MouseBtnSt=bt.Class({},null,bn);bn.New=function(bN,bO,bP,bQ){return new bn({Active:bN,Left:bO,Middle:bP,Right:bQ});};bo.get_MousePressed=function(){var bN,bO,bP,bQ,bR,bS;bl.ActivateButtonListener();bN=(bO=(bP=x.Const(bt.Curried3(function(bT,bU,bV){return(bT?true:bU)?true:bV;})),bQ=bl.MouseBtnSt$1().Left.get_View(),x.Apply(bP,bQ)),bR=bl.MouseBtnSt$1().Middle.get_View(),x.Apply(bO,bR));bS=bl.MouseBtnSt$1().Right.get_View();return x.Apply(bN,bS);};bo.get_RightPressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Right.get_View();};bo.get_MiddlePressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Middle.get_View();};bo.get_LeftPressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Left.get_View();};bo.get_Position=function(){var bN;bN=function(bO){var bP,bQ;bP=bl.MousePosSt$1().PosV;bQ=[bO.clientX,bO.clientY];y.Set(bP,bQ);};!bl.MousePosSt$1().Active?(a.document.addEventListener("mousemove",bN,false),bl.MousePosSt$1().Active=true):null;return bl.MousePosSt$1().PosV.get_View();};bp=bl.KeyListenerSt=bt.Class({},null,bp);bp.New=function(bN,bO,bP){return new bp({KeysPressed:bN,KeyListenerActive:bO,LastPressed:bP});};bq.IsPressed=function(bN){var bO,bP,bQ;bl.ActivateKeyListener();bO=(bP=function(bR){return bR===bN;},function(bR){return bz.exists(bP,bR);});bQ=bl.KeyListenerState().KeysPressed.get_View();return x.Map(bO,bQ);};bq.get_LastPressed=function(){bl.ActivateKeyListener();return bl.KeyListenerState().LastPressed.get_View();};bq.get_KeysPressed=function(){bl.ActivateKeyListener();return bl.KeyListenerState().KeysPressed.get_View();};bl.ActivateKeyListener=function(){br.$cctor();return br.ActivateKeyListener;};bl.KeyListenerState=function(){br.$cctor();return br.KeyListenerState;};bl.ActivateButtonListener=function(){br.$cctor();return br.ActivateButtonListener;};bl.MouseBtnSt$1=function(){br.$cctor();return br.MouseBtnSt;};bl.MousePosSt$1=function(){br.$cctor();return br.MousePosSt;};br.$cctor=bt.Cctor(function(){var bN,bO,bP,bQ,bR;br.MousePosSt=bm.New(false,y.Create$1([0,0]));br.MouseBtnSt=bn.New(false,y.Create$1(false),y.Create$1(false),y.Create$1(false));br.ActivateButtonListener=(bN=bt.Curried2(function(bS,bT){var bU,bV,bW,bX;bU=bS.button;bU===0?(bV=bl.MouseBtnSt$1().Left,y.Set(bV,bT)):bU===1?(bW=bl.MouseBtnSt$1().Middle,y.Set(bW,bT)):bU===2?(bX=bl.MouseBtnSt$1().Right,y.Set(bX,bT)):null;}),!bl.MouseBtnSt$1().Active?(bl.MouseBtnSt$1().Active=true,a.document.addEventListener("mousedown",function(bS){return(bN(bS))(true);},false),a.document.addEventListener("mouseup",function(bS){return(bN(bS))(false);},false)):null);br.KeyListenerState=bp.New(y.Create$1(new bC.T({$:0})),false,y.Create$1(-1));br.ActivateKeyListener=!bl.KeyListenerState().KeyListenerActive?(bO=(bP=a.document,a.jQuery(bP)),bO.keydown(bt.CreateFuncWithThis(bt.Curried2(function(bS,bT){var bU,bV,bW,bX,bY;bU=bT.which;bV=bl.KeyListenerState().LastPressed;y.Set(bV,bU);bW=y.Get(bl.KeyListenerState().KeysPressed);!bz.exists(function(bZ){return bZ===bU;},bW)?(bX=bl.KeyListenerState().KeysPressed,bY=bC.append(bW,bC.ofArray([bU])),y.Set(bX,bY)):null;}))),bQ=(bR=a.document,a.jQuery(bR)),bQ.keyup(bt.CreateFuncWithThis(bt.Curried2(function(bS,bT){var bU,bV,bW,bX;bU=bT.which;bV=bl.KeyListenerState().KeysPressed;bW=(bX=function(bY){return bY!==bU;},function(bY){return bC.filter(bX,bY);});y.Update(bV,bW);})))):null;});}());
