(function(){var a=this,b=a.WebSharper=a.WebSharper||{},c=b.Control=b.Control||{},d=c.Observer=c.Observer||{},e=d.Message=d.Message||{},f=c.HotStream=c.HotStream||{},g=f.HotStream=f.HotStream||{},h=c.Observable=c.Observable||{},i=a.Microsoft=a.Microsoft||{},j=i.FSharp=i.FSharp||{},k=j.Control=j.Control||{},l=k.ObservableModule=k.ObservableModule||{},m=c.Event=c.Event||{},n=m.Event=m.Event||{},o=c.DelegateEvent=c.DelegateEvent||{},p=o.DelegateEvent=o.DelegateEvent||{},q=c.FSharpEvent=c.FSharpEvent||{},r=c.FSharpDelegateEvent=c.FSharpDelegateEvent||{},s=k.EventModule=k.EventModule||{},t=c.MailboxProcessor=c.MailboxProcessor||{},u=a.IntelliFactory,v=u&&u.Runtime,w=b&&b.Util,x=b&&b.List,y=b&&b.Ref,z=b&&b.Option,A=b&&b.Unchecked,B=b&&b.Seq,C=b&&b.Arrays,D=b&&b.Collections,E=D&&D.List,F=b&&b.Concurrency,G=b&&b.TimeoutException,H=b&&b.Operators,I=D&&D.LinkedList;e=d.Message=v.Class({},null,e);d.New=function(J,K,L){return{OnCompleted:L,OnError:K,OnNext:J};};d.Of=function(J){return{OnCompleted:function(){return null;},OnError:function(K){throw K;},OnNext:J};};g=f.HotStream=v.Class({Trigger:function(J){this.Latest[0]={$:1,$0:J};this.Event.event.Trigger(J);},Subscribe:function(J){this.Latest[0]!=null?J.OnNext(this.Latest[0].$0):null;return w.subscribeTo(this.Event.event,function(K){J.OnNext(K);});}},null,g);g.New$1=function(){return g.New([null],new q.New());};g.New=function(J,K){return new g({Latest:J,Event:K});};h.Sequence=function(J){var K;K=function(L){var M;return L.$==1?(M=K(L.$1),h.CombineLatest(L.$0,M,v.Curried2(function(N,O){return new x.T({$:1,$0:N,$1:O});}))):h.Return(new x.T({$:0}));};return K(x.ofSeq(J));};h.Aggregate=function(J,K,L){return{Subscribe:function(M){var N;N=[K];return J.Subscribe(d.New(function(O){h.Protect(function(){return(L(N[0]))(O);},function(P){N[0]=P;M.OnNext(P);},function(P){M.OnError(P);});},function(O){M.OnError(O);},function(){M.OnCompleted();}));}};};h.SelectMany=function(J){return{Subscribe:function(K){var L,M,N;L=[function(){}];M=w.subscribeTo(J,function(O){var P;P=w.subscribeTo(O,function(Q){K.OnNext(Q);});L[0]=function(){L[0]();P.Dispose();};});N=function(){L[0]();M.Dispose();};return{Dispose:N};}};};h.Switch=function(J){return{Subscribe:function(K){var L,M;L=[0];M=[null];return w.subscribeTo(J,function(N){var O;y.incr(L);M[0]!=null?M[0].$0.Dispose():null;O=L[0];M[0]={$:1,$0:w.subscribeTo(N,function(P){O===L[0]?K.OnNext(P):null;})};});}};};h.CombineLatest=function(J,K,L){return{Subscribe:function(M){var N,O,P,Q,R,S;N=[null];O=[null];P=function(){var T,U,V,W,X;T=[N[0],O[0]];(U=T[0],U!=null?U.$==1:false)?(V=T[1],V!=null?V.$==1:false)?(W=T[0].$0,X=T[1].$0,h.Protect(function(){return(L(W))(X);},function(Y){M.OnNext(Y);},function(Y){M.OnError(Y);})):null:null;};Q=J.Subscribe(d.New(function(T){N[0]={$:1,$0:T};P();},function(){},function(){}));R=K.Subscribe(d.New(function(T){O[0]={$:1,$0:T};P();},function(){},function(){}));S=function(){Q.Dispose();R.Dispose();};return{Dispose:S};}};};h.Range=function(J,K){return{Subscribe:function(L){var M,N,O;for(N=J,O=J+K;N<=O;N++)L.OnNext(N);M=function(){};return{Dispose:M};}};};h.Concat=function(J,K){return{Subscribe:function(L){var M,N;M=[null];N=J.Subscribe(d.New(function(O){L.OnNext(O);},function(){},function(){M[0]={$:1,$0:K.Subscribe(L)};}));return{Dispose:function(){M[0]!=null?M[0].$0.Dispose():null;N.Dispose();}};}};};h.Merge=function(J,K){return{Subscribe:function(L){var M,N,O,P,Q;M=[false];N=[false];O=J.Subscribe(d.New(function(R){L.OnNext(R);},function(){},function(){M[0]=true;(M[0]?N[0]:false)?L.OnCompleted():null;}));P=K.Subscribe(d.New(function(R){L.OnNext(R);},function(){},function(){N[0]=true;(M[0]?N[0]:false)?L.OnCompleted():null;}));Q=function(){O.Dispose();P.Dispose();};return{Dispose:Q};}};};h.Drop=function(J,K){return{Subscribe:function(L){var M;M=[0];return K.Subscribe(d.New(function(N){y.incr(M);M[0]>J?L.OnNext(N):null;},function(N){L.OnError(N);},function(){L.OnCompleted();}));}};};h.Choose=function(J,K){return{Subscribe:function(L){return K.Subscribe(d.New(function(M){var N;h.Protect(function(){return J(M);},(N=function(O){L.OnNext(O);},function(O){z.iter(N,O);}),function(O){L.OnError(O);});},function(M){L.OnError(M);},function(){L.OnCompleted();}));}};};h.Filter=function(J,K){return{Subscribe:function(L){return K.Subscribe(d.New(function(M){var N;h.Protect(function(){return J(M)?{$:1,$0:M}:null;},(N=function(O){L.OnNext(O);},function(O){z.iter(N,O);}),function(O){L.OnError(O);});},function(M){L.OnError(M);},function(){L.OnCompleted();}));}};};h.Map=function(J,K){return{Subscribe:function(L){return K.Subscribe(d.New(function(M){h.Protect(function(){return J(M);},function(N){L.OnNext(N);},function(N){L.OnError(N);});},function(M){L.OnError(M);},function(){L.OnCompleted();}));}};};h.Protect=function(J,K,L){var M;try{M=new b.Choice2({$:0,$0:J()});}catch(N){M=new b.Choice2({$:1,$0:N});}return M.$==1?L(M.$0):K(M.$0);};h.Never=function(){return{Subscribe:function(){var J;J=function(){};return{Dispose:J};}};};h.Return=function(J){return{Subscribe:function(K){var L;K.OnNext(J);K.OnCompleted();L=function(){};return{Dispose:L};}};};h.Of=function(J){return{Subscribe:function(K){var L;L=J(function(M){K.OnNext(M);});return{Dispose:L};}};};l.Split=function(J,K){var L,M,N;L=(M=function(O){var P;P=J(O);return P.$==0?{$:1,$0:P.$0}:null;},function(O){return h.Choose(M,O);})(K);return[L,(N=function(O){var P;P=J(O);return P.$==1?{$:1,$0:P.$0}:null;},function(O){return h.Choose(N,O);})(K)];};l.Scan=function(J,K,L){return{Subscribe:function(M){var N;N=[K];return L.Subscribe(d.New(function(O){h.Protect(function(){return(J(N[0]))(O);},function(P){N[0]=P;M.OnNext(P);},function(P){M.OnError(P);});},function(O){M.OnError(O);},function(){M.OnCompleted();}));}};};l.Partition=function(J,K){var L;return[h.Filter(J,K),h.Filter((L=function(M){return!M;},function(M){return L(J(M));}),K)];};l.Pairwise=function(J){return{Subscribe:function(K){var L;L=[null];return J.Subscribe(d.New(function(M){var N;N=L[0];(N!=null?N.$==1:false)?K.OnNext([N.$0,M]):null;L[0]={$:1,$0:M};},function(M){K.OnError(M);},function(){K.OnCompleted();}));}};};n=m.Event=v.Class({Subscribe$1:function(J){var K,L,M;K=this;L=function(N,O){return J.OnNext(O);};this.AddHandler$1(L);M=function(){K.RemoveHandler$1(L);};return{Dispose:M};},RemoveHandler$1:function(J){var K,L,M,N;K=(L=function(O){return A.Equals(J,O);},function(O){return B.tryFindIndex(L,O);})(this.Handlers);(M=(N=this.Handlers,function(O){N.RemoveAt(O);}),function(O){z.iter(M,O);})(K);},AddHandler$1:function(J){this.Handlers.Add(J);},Trigger:function(J){var L,M,K=this.Handlers.ToArray();for(L=0,M=K.length-1;L<=M;L++)(C.get(K,L))(null,J);},RemoveHandler:function(J){this.RemoveHandler$1(J);},AddHandler:function(J){this.AddHandler$1(J);},Subscribe:function(J){return this.Subscribe$1(J);},Dispose:function(){}},null,n);n.New=function(J){return new n({Handlers:J});};p=o.DelegateEvent=v.Class({RemoveHandler$1:function(J){var K,L,M,N;K=(L=function(O){return A.Equals(J,O);},function(O){return B.tryFindIndex(L,O);})(this.Handlers);(M=(N=this.Handlers,function(O){N.RemoveAt(O);}),function(O){z.iter(M,O);})(K);},AddHandler$1:function(J){this.Handlers.Add(J);},Trigger:function(J){var L,M,K=this.Handlers.ToArray();for(L=0,M=K.length-1;L<=M;L++)C.get(K,L).apply(null,J);},RemoveHandler:function(J){this.RemoveHandler$1(J);},AddHandler:function(J){this.AddHandler$1(J);},Dispose:function(){}},null,p);p.New=function(J){return new p({Handlers:J});};q=c.FSharpEvent=v.Class({},null,q);q.New=v.Ctor(function(){this.event=n.New(new E.New$2());null;},q);r=c.FSharpDelegateEvent=v.Class({},null,r);r.New=v.Ctor(function(){this.event=p.New(new E.New$2());null;},r);s.Split=function(J,K){var L,M;return[(L=function(N){var O;O=J(N);return O.$==0?{$:1,$0:O.$0}:null;},function(N){return s.Choose(L,N);})(K),(M=function(N){var O;O=J(N);return O.$==1?{$:1,$0:O.$0}:null;},function(N){return s.Choose(M,N);})(K)];};s.Scan=function(J,K,L){var M;M=[K];return s.Map(function(N){M[0]=(J(M[0]))(N);return M[0];},L);};s.Partition=function(J,K){var L;return[s.Filter(J,K),s.Filter((L=function(M){return!M;},function(M){return L(J(M));}),K)];};s.Pairwise=function(J){var K,L;K=[null];L=n.New(new E.New$2());w.addListener(J,function(M){var N;N=K[0];(N!=null?N.$==1:false)?(K[0]={$:1,$0:M},L.Trigger([N.$0,M])):void(K[0]={$:1,$0:M});});return L;};s.Merge=function(J,K){var L;L=n.New(new E.New$2());w.addListener(J,function(M){L.Trigger(M);});w.addListener(K,function(M){L.Trigger(M);});return L;};s.Map=function(J,K){var L;L=n.New(new E.New$2());w.addListener(K,function(M){L.Trigger(J(M));});return L;};s.Filter=function(J,K){var L;L=n.New(new E.New$2());w.addListener(K,function(M){J(M)?L.Trigger(M):null;});return L;};s.Choose=function(J,K){var L;L=new q.New();w.addListener(K,function(M){var N;N=J(M);N==null?null:L.event.Trigger(N.$0);});return L.event;};t=c.MailboxProcessor=v.Class({dequeue:function(){var J;J=this.mailbox.n.v;this.mailbox.RemoveFirst();return J;},resume:function(){var J,K;J=this;K=this.savedCont;(K!=null?K.$==1:false)?(this.savedCont=null,J.startAsync(K.$0)):null;},startAsync:function(J){F.Start(J,this.token);},Scan:function(J,K){var L;L=this;return F.Delay(function(){var M;M=L.TryScan(J,K);return F.Bind(M,function(N){var O;if(N!=null?N.$==1:false)O=N.$0;else{var P=new G.New();throw P;O=void 0;}return F.Return(O);});});},TryScan:function(J,K){var L,M;L=this;M=H.DefaultArg(K,this.get_DefaultTimeout());return F.Delay(function(){var N;N=function(){var O,P;O=L.mailbox.n;P=null;while(!A.Equals(O,null)){var Q;Q=J(O.v);Q==null?void(O=O.n):(L.mailbox.Remove$1(O),O=null,void(P=Q));}return P;}();return(N!=null?N.$==1:false)?F.Bind(N.$0,function(O){return F.Return({$:1,$0:O});}):F.FromContinuations(function(O){var P,Q,R=O[0];if(M<0){P=function(){L.savedCont={$:1,$0:F.Delay(function(){var S;S=J(L.mailbox.n.v);return(S!=null?S.$==1:false)?(L.mailbox.RemoveFirst(),F.Bind(S.$0,function(T){R({$:1,$0:T});return F.Return(null);})):(P(),F.Return(null));})};};P();}else{var S=[true],T=a.setTimeout(function(){S[0]?(S[0]=false,L.savedCont=null,R(null)):null;},M);Q=function(){L.savedCont={$:1,$0:F.Delay(function(){var U;U=J(L.mailbox.n.v);return(U!=null?U.$==1:false)?(L.mailbox.RemoveFirst(),F.Bind(U.$0,function(V){return S[0]?(S[0]=false,a.clearTimeout(T),R({$:1,$0:V}),F.Return(null)):F.Return(null);})):(Q(),F.Return(null));})};};Q();}});});},PostAndAsyncReply:function(J,K){var L;L=this;return F.Delay(function(){var M;M=L.PostAndTryAsyncReply(J,K);return F.Bind(M,function(N){var O;if(N!=null?N.$==1:false)O=N.$0;else{var P=new G.New();throw P;O=void 0;}return F.Return(O);});});},PostAndTryAsyncReply:function(J,K){var L,M;L=this;M=H.DefaultArg(K,this.get_DefaultTimeout());return F.FromContinuations(function(N){var O,P,Q;O=N[0];M<0?(L.mailbox.AddLast(J((P=function(R){return{$:1,$0:R};},function(R){return O(P(R));}))),L.resume()):(Q=[true],L.mailbox.AddLast(J(function(R){Q[0]?(Q[0]=false,O({$:1,$0:R})):null;})),L.resume(),a.setTimeout(function(){Q[0]?(Q[0]=false,O(null)):null;},M));});},get_CurrentQueueLength:function(){return this.mailbox.c;},Receive:function(J){var K;K=this;return F.Delay(function(){var L;L=K.TryReceive(J);return F.Bind(L,function(M){var N;if(M!=null?M.$==1:false)N=M.$0;else{var O=new G.New();throw O;N=void 0;}return F.Return(N);});});},TryReceive:function(J){var K,L;K=this;L=H.DefaultArg(J,this.get_DefaultTimeout());return F.FromContinuations(function(M){var N,O,P;N=M[0];A.Equals(K.mailbox.n,null)?L<0?K.savedCont={$:1,$0:F.Delay(function(){N({$:1,$0:K.dequeue()});return F.Return(null);})}:(O=[true],P=a.setTimeout(function(){O[0]?(O[0]=false,K.savedCont=null,N(null)):null;},L),K.savedCont={$:1,$0:F.Delay(function(){return O[0]?(O[0]=false,a.clearTimeout(P),N({$:1,$0:K.dequeue()}),F.Return(null)):F.Return(null);})}):N({$:1,$0:K.dequeue()});});},Start:function(){var J;J=this;this.started?H.FailWith("The MailboxProcessor has already been started."):(this.started=true,J.startAsync(F.Delay(function(){var K;K=F.Delay(function(){var L;L=J.initial(J);return F.Bind(L,function(){return F.Return(null);});});return F.TryWith(K,function(L){J.errorEvent.event.Trigger(L);return F.Return(null);});})));},set_DefaultTimeout:function(J){this["DefaultTimeout@"]=J;},get_DefaultTimeout:function(){return this["DefaultTimeout@"];},remove_Error:function(J){this.errorEvent.event.RemoveHandler(J);},add_Error:function(J){this.errorEvent.event.AddHandler(J);},get_Error:function(){return this.errorEvent.event;}},null,t);t.Start=function(J,K){var L;L=new t.New(J,K);L.Start();return L;};t.New=v.Ctor(function(J,K){var L,M,N;L=this;this.initial=J;this.token=K;this.started=false;this.errorEvent=new q.New();this.mailbox=new I.New();this.savedCont=null;M=this.token;M==null?null:(N=function(){L.resume();},F.Register(M.$0,function(){N();}));this["DefaultTimeout@"]=-1;null;},t);}());
